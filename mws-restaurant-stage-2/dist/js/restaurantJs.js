"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}var restaurant,map,DBHelper=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"idbDatabase",value:function(){return navigator.serviceWorker?idb.open("mws-restaurant",1,function(e){e.createObjectStore("restaurantDb",{keyPath:"id"}).createIndex("id","id")}):Promise.resolve}},{key:"handleErrors",value:function(t){return t.ok||e.idbDatabase().then(function(e){if(!e)throw Error(t.statusText);var n=e.transaction("restaurantDb","readwrite").objectStore("restaurantDb");if(n.getAll()<=0)throw Error(t.statusText);return n.getAll()}),t.json()}},{key:"fetchRestaurants",value:function(t){return fetch(this.DATABASE_URL).then(this.handleErrors).then(function(n){var r=n;e.idbDatabase().then(function(e){if(e){var t=e.transaction("restaurantDb","readwrite").objectStore("restaurantDb");r.forEach(function(e){t.put(e)});t.index("id").openCursor(null,"prev").then(function(e){return e.advance(30)}).then(function e(t){if(t)return t.delete(),t.continue().then(e)});return t.getAll()}}).then(function(e){return t(null,e),e})}).catch(function(e){return console.log(e)})}},{key:"fetchRestaurantById",value:function(t,n){e.fetchRestaurants(function(e,r){if(e)n(e,null);else{var o=r.find(function(e){return e.id==t});o?n(null,o):n("Restaurant does not exist",null)}})}},{key:"fetchRestaurantByCuisine",value:function(t,n){e.fetchRestaurants(function(e,r){if(e)n(e,null);else{var o=r.filter(function(e){return e.cuisine_type==t});n(null,o)}})}},{key:"fetchRestaurantByNeighborhood",value:function(t,n){e.fetchRestaurants(function(e,r){if(e)n(e,null);else{var o=r.filter(function(e){return e.neighborhood==t});n(null,o)}})}},{key:"fetchRestaurantByCuisineAndNeighborhood",value:function(t,n,r){e.fetchRestaurants(function(e,o){if(e)r(e,null);else{var a=o;"all"!=t&&(a=a.filter(function(e){return e.cuisine_type==t})),"all"!=n&&(a=a.filter(function(e){return e.neighborhood==n})),r(null,a)}})}},{key:"fetchNeighborhoods",value:function(t){e.fetchRestaurants(function(e,n){if(e)t(e,null);else{var r=n.map(function(e,t){return n[t].neighborhood}),o=r.filter(function(e,t){return r.indexOf(e)==t});t(null,o)}})}},{key:"fetchCuisines",value:function(t){e.fetchRestaurants(function(e,n){if(e)t(e,null);else{var r=n.map(function(e,t){return n[t].cuisine_type}),o=r.filter(function(e,t){return r.indexOf(e)==t});t(null,o)}})}},{key:"urlForRestaurant",value:function(e){return"./restaurant.html?id=".concat(e.id)}},{key:"imageUrlForRestaurant",value:function(e){return"/img/".concat(e.photograph,".jpg")}},{key:"mapMarkerForRestaurant",value:function(t,n){var r=new google.maps.Marker({position:t.latlng,title:t.name,url:e.urlForRestaurant(t),map:n,animation:google.maps.Animation.DROP});return r.tabindex=-1,r}},{key:"DATABASE_URL",get:function(){return"http://localhost:1337/restaurants"}}]),e}();function lazyLoader(){console.log("executing lazy loading");var e=[].slice.call(document.querySelectorAll("img.lazy")),t=!1,n=function n(){!1===t&&(t=!0,setTimeout(function(){e.forEach(function(t){t.getBoundingClientRect().top<=window.innerHeight&&t.getBoundingClientRect().bottom>=0&&"none"!==getComputedStyle(t).display&&(t.src=t.getAttribute("data-src"),t.classList.remove("lazy"),0===(e=e.filter(function(e){return e!==t})).length&&(document.removeEventListener("scroll",n),window.removeEventListener("resize",n),window.removeEventListener("orientationchange",n)))}),t=!1},200))};document.addEventListener("scroll",n),window.addEventListener("resize",n),window.addEventListener("orientationchange",n)}!function(){function e(e){return new Promise(function(t,n){e.onsuccess=function(){t(e.result)},e.onerror=function(){n(e.error)}})}function t(t,n,r){var o,a=new Promise(function(a,i){e(o=t[n].apply(t,r)).then(a,i)});return a.request=o,a}function n(e,t,n){n.forEach(function(n){Object.defineProperty(e.prototype,n,{get:function(){return this[t][n]},set:function(e){this[t][n]=e}})})}function r(e,n,r,o){o.forEach(function(o){o in r.prototype&&(e.prototype[o]=function(){return t(this[n],o,arguments)})})}function o(e,t,n,r){r.forEach(function(r){r in n.prototype&&(e.prototype[r]=function(){return this[t][r].apply(this[t],arguments)})})}function a(e,n,r,o){o.forEach(function(o){o in r.prototype&&(e.prototype[o]=function(){return e=this[n],(r=t(e,o,arguments)).then(function(e){if(e)return new u(e,r.request)});var e,r})})}function i(e){this._index=e}function u(e,t){this._cursor=e,this._request=t}function c(e){this._store=e}function s(e){this._tx=e,this.complete=new Promise(function(t,n){e.oncomplete=function(){t()},e.onerror=function(){n(e.error)},e.onabort=function(){n(e.error)}})}function l(e,t,n){this._db=e,this.oldVersion=t,this.transaction=new s(n)}function f(e){this._db=e}n(i,"_index",["name","keyPath","multiEntry","unique"]),r(i,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),a(i,"_index",IDBIndex,["openCursor","openKeyCursor"]),n(u,"_cursor",["direction","key","primaryKey","value"]),r(u,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(t){t in IDBCursor.prototype&&(u.prototype[t]=function(){var n=this,r=arguments;return Promise.resolve().then(function(){return n._cursor[t].apply(n._cursor,r),e(n._request).then(function(e){if(e)return new u(e,n._request)})})})}),c.prototype.createIndex=function(){return new i(this._store.createIndex.apply(this._store,arguments))},c.prototype.index=function(){return new i(this._store.index.apply(this._store,arguments))},n(c,"_store",["name","keyPath","indexNames","autoIncrement"]),r(c,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),a(c,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),o(c,"_store",IDBObjectStore,["deleteIndex"]),s.prototype.objectStore=function(){return new c(this._tx.objectStore.apply(this._tx,arguments))},n(s,"_tx",["objectStoreNames","mode"]),o(s,"_tx",IDBTransaction,["abort"]),l.prototype.createObjectStore=function(){return new c(this._db.createObjectStore.apply(this._db,arguments))},n(l,"_db",["name","version","objectStoreNames"]),o(l,"_db",IDBDatabase,["deleteObjectStore","close"]),f.prototype.transaction=function(){return new s(this._db.transaction.apply(this._db,arguments))},n(f,"_db",["name","version","objectStoreNames"]),o(f,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(e){[c,i].forEach(function(t){e in t.prototype&&(t.prototype[e.replace("open","iterate")]=function(){var t,n=(t=arguments,Array.prototype.slice.call(t)),r=n[n.length-1],o=this._store||this._index,a=o[e].apply(o,n.slice(0,-1));a.onsuccess=function(){r(a.result)}})})}),[i,c].forEach(function(e){e.prototype.getAll||(e.prototype.getAll=function(e,t){var n=this,r=[];return new Promise(function(o){n.iterateCursor(e,function(e){e?(r.push(e.value),void 0===t||r.length!=t?e.continue():o(r)):o(r)})})})});var d={open:function(e,n,r){var o=t(indexedDB,"open",[e,n]),a=o.request;return a&&(a.onupgradeneeded=function(e){r&&r(new l(a.result,e.oldVersion,a.transaction))}),o.then(function(e){return new f(e)})},delete:function(e){return t(indexedDB,"deleteDatabase",[e])}};"undefined"!=typeof module?(module.exports=d,module.exports.default=module.exports):self.idb=d}(),navigator.serviceWorker&&navigator.serviceWorker.register("sw.js").then(function(e){console.log("service worker registered."),console.log(e)}).catch(function(e){console.log("problem registering service worker"),console.log(e)}),window.initMap=function(){fetchRestaurantFromURL(function(e,t){e?console.error(e):(self.map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:t.latlng,scrollwheel:!1}),fillBreadcrumb(),DBHelper.mapMarkerForRestaurant(self.restaurant,self.map))})};var fetchRestaurantFromURL=function(e){if(self.restaurant)e(null,self.restaurant);else{var t=getParameterByName("id");t?DBHelper.fetchRestaurantById(t,function(t,n){self.restaurant=n,n?(fillRestaurantHTML(),e(null,n)):console.error(t)}):(error="No restaurant id in URL",e(error,null))}},fillRestaurantHTML=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:self.restaurant,t=document.getElementById("restaurant-name");t.innerHTML=e.name,t.setAttribute("aria-label","restaurant name: ".concat(e.name));var n=document.getElementById("restaurant-address");n.innerHTML=e.address,n.setAttribute("aria-label","restaurant address: ".concat(e.address));var r=document.getElementById("restaurant-img");r.className="restaurant-img lazy",r.alt=e.name,r.setAttribute("src"," "),r.setAttribute("data-src",DBHelper.imageUrlForRestaurant(e));var o=document.getElementById("restaurant-cuisine");o.innerHTML=e.cuisine_type,o.setAttribute("aria-label","cuisine type: ".concat(e.cuisine_type)),e.operating_hours&&fillRestaurantHoursHTML(),fillReviewsHTML(),lazyLoader()},fillRestaurantHoursHTML=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:self.restaurant.operating_hours,t=document.getElementById("restaurant-hours"),n=[];for(var r in e){var o=document.createElement("tr"),a=document.createElement("td");a.innerHTML=r,o.appendChild(a);var i=document.createElement("td");i.innerHTML=e[r],o.appendChild(i),t.appendChild(o),n.push("".concat(r," ").concat(e[r]," "))}console.log(n),t.setAttribute("aria-label","Restaruant Hours ".concat(n.join(". ").replace(/-/g,"to")))},fillReviewsHTML=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:self.restaurant.reviews,t=document.getElementById("reviews-container"),n=document.createElement("h3");if(n.innerHTML="Reviews",t.appendChild(n),!e){var r=document.createElement("p");return r.innerHTML="No reviews yet!",void t.appendChild(r)}var o=document.getElementById("reviews-list");e.forEach(function(e){o.appendChild(createReviewHTML(e))}),t.appendChild(o)},createReviewHTML=function(e){var t=document.createElement("li"),n=document.createElement("p");n.innerHTML=e.name,t.appendChild(n);var r=document.createElement("p");r.innerHTML=e.date,r.setAttribute("tabindex","0"),t.appendChild(r);var o=document.createElement("p");o.innerHTML="Rating: ".concat(e.rating),o.setAttribute("tabindex","0"),t.appendChild(o);var a=document.createElement("p");return a.innerHTML=e.comments,a.setAttribute("tabindex","0"),t.appendChild(a),t.setAttribute("aria-label","review by ".concat(e.name)),t.setAttribute("tabindex","0"),t},fillBreadcrumb=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:self.restaurant,t=document.getElementById("breadcrumb"),n=document.createElement("li");n.innerHTML=e.name,t.appendChild(n)},getParameterByName=function(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]".concat(e,"(=([^&#]*)|&|#|$)")).exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRiaGVscGVyLmpzIiwicmVzdGF1cmFudF9pbmZvLmpzIiwibGF6eWxvYWRlci5qcyIsImlkYi5qcyIsInJlZ2lzdGVyc3cuanMiXSwibmFtZXMiOlsiX2NsYXNzQ2FsbENoZWNrIiwiaW5zdGFuY2UiLCJDb25zdHJ1Y3RvciIsIlR5cGVFcnJvciIsIl9kZWZpbmVQcm9wZXJ0aWVzIiwidGFyZ2V0IiwicHJvcHMiLCJpIiwibGVuZ3RoIiwiZGVzY3JpcHRvciIsImVudW1lcmFibGUiLCJjb25maWd1cmFibGUiLCJ3cml0YWJsZSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5Iiwia2V5IiwiX2NyZWF0ZUNsYXNzIiwicHJvdG9Qcm9wcyIsInN0YXRpY1Byb3BzIiwicHJvdG90eXBlIiwicmVzdGF1cmFudCIsIm1hcCIsIkRCSGVscGVyIiwidGhpcyIsInZhbHVlIiwibmF2aWdhdG9yIiwic2VydmljZVdvcmtlciIsImlkYiIsIm9wZW4iLCJ1cGdyYWRlREIiLCJjcmVhdGVPYmplY3RTdG9yZSIsImtleVBhdGgiLCJjcmVhdGVJbmRleCIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVzcG9uc2UiLCJvayIsImlkYkRhdGFiYXNlIiwidGhlbiIsImRiIiwiRXJyb3IiLCJzdGF0dXNUZXh0Iiwic3RvcmUiLCJ0cmFuc2FjdGlvbiIsIm9iamVjdFN0b3JlIiwiZ2V0QWxsIiwianNvbiIsImNhbGxiYWNrIiwiZmV0Y2giLCJEQVRBQkFTRV9VUkwiLCJoYW5kbGVFcnJvcnMiLCJyZXMiLCJyZXN0YXVyYW50cyIsImZvckVhY2giLCJwdXQiLCJpbmRleCIsIm9wZW5DdXJzb3IiLCJjdXJzb3IiLCJhZHZhbmNlIiwiZGVsZXRlUmVzdCIsImRlbGV0ZSIsImNvbnRpbnVlIiwiY2F0Y2giLCJlcnIiLCJjb25zb2xlIiwibG9nIiwiaWQiLCJmZXRjaFJlc3RhdXJhbnRzIiwiZXJyb3IiLCJmaW5kIiwiciIsImN1aXNpbmUiLCJyZXN1bHRzIiwiZmlsdGVyIiwiY3Vpc2luZV90eXBlIiwibmVpZ2hib3Job29kIiwibmVpZ2hib3Job29kcyIsInYiLCJ1bmlxdWVOZWlnaGJvcmhvb2RzIiwiaW5kZXhPZiIsImN1aXNpbmVzIiwidW5pcXVlQ3Vpc2luZXMiLCJjb25jYXQiLCJwaG90b2dyYXBoIiwibWFya2VyIiwiZ29vZ2xlIiwibWFwcyIsIk1hcmtlciIsInBvc2l0aW9uIiwibGF0bG5nIiwidGl0bGUiLCJuYW1lIiwidXJsIiwidXJsRm9yUmVzdGF1cmFudCIsImFuaW1hdGlvbiIsIkFuaW1hdGlvbiIsIkRST1AiLCJ0YWJpbmRleCIsImdldCIsImxhenlMb2FkZXIiLCJsYXp5SW1hZ2VzIiwic2xpY2UiLCJjYWxsIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yQWxsIiwiYWN0aXZlIiwibGF6eUxvYWQiLCJzZXRUaW1lb3V0IiwibGF6eUltYWdlIiwiZ2V0Qm91bmRpbmdDbGllbnRSZWN0IiwidG9wIiwid2luZG93IiwiaW5uZXJIZWlnaHQiLCJib3R0b20iLCJnZXRDb21wdXRlZFN0eWxlIiwiZGlzcGxheSIsInNyYyIsImdldEF0dHJpYnV0ZSIsImNsYXNzTGlzdCIsInJlbW92ZSIsImltYWdlIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImFkZEV2ZW50TGlzdGVuZXIiLCJwcm9taXNpZnlSZXF1ZXN0IiwicmVxdWVzdCIsInJlamVjdCIsIm9uc3VjY2VzcyIsInJlc3VsdCIsIm9uZXJyb3IiLCJwcm9taXNpZnlSZXF1ZXN0Q2FsbCIsIm9iaiIsIm1ldGhvZCIsImFyZ3MiLCJwIiwiYXBwbHkiLCJwcm94eVByb3BlcnRpZXMiLCJQcm94eUNsYXNzIiwidGFyZ2V0UHJvcCIsInByb3BlcnRpZXMiLCJwcm9wIiwic2V0IiwidmFsIiwicHJveHlSZXF1ZXN0TWV0aG9kcyIsImFyZ3VtZW50cyIsInByb3h5TWV0aG9kcyIsInByb3h5Q3Vyc29yUmVxdWVzdE1ldGhvZHMiLCJDdXJzb3IiLCJJbmRleCIsIl9pbmRleCIsIl9jdXJzb3IiLCJfcmVxdWVzdCIsIk9iamVjdFN0b3JlIiwiX3N0b3JlIiwiVHJhbnNhY3Rpb24iLCJpZGJUcmFuc2FjdGlvbiIsIl90eCIsImNvbXBsZXRlIiwib25jb21wbGV0ZSIsIm9uYWJvcnQiLCJVcGdyYWRlREIiLCJvbGRWZXJzaW9uIiwiX2RiIiwiREIiLCJJREJJbmRleCIsIklEQkN1cnNvciIsIm1ldGhvZE5hbWUiLCJJREJPYmplY3RTdG9yZSIsIklEQlRyYW5zYWN0aW9uIiwiSURCRGF0YWJhc2UiLCJmdW5jTmFtZSIsInJlcGxhY2UiLCJhcnIiLCJBcnJheSIsIm5hdGl2ZU9iamVjdCIsInF1ZXJ5IiwiY291bnQiLCJpdGVtcyIsIml0ZXJhdGVDdXJzb3IiLCJwdXNoIiwidW5kZWZpbmVkIiwiZXhwIiwidmVyc2lvbiIsInVwZ3JhZGVDYWxsYmFjayIsImluZGV4ZWREQiIsIm9udXBncmFkZW5lZWRlZCIsImV2ZW50IiwibW9kdWxlIiwiZXhwb3J0cyIsImRlZmF1bHQiLCJzZWxmIiwicmVnaXN0ZXIiLCJyZWciLCJpbml0TWFwIiwiZmV0Y2hSZXN0YXVyYW50RnJvbVVSTCIsIk1hcCIsImdldEVsZW1lbnRCeUlkIiwiem9vbSIsImNlbnRlciIsInNjcm9sbHdoZWVsIiwiZmlsbEJyZWFkY3J1bWIiLCJtYXBNYXJrZXJGb3JSZXN0YXVyYW50IiwiZ2V0UGFyYW1ldGVyQnlOYW1lIiwiZmV0Y2hSZXN0YXVyYW50QnlJZCIsImZpbGxSZXN0YXVyYW50SFRNTCIsImlubmVySFRNTCIsInNldEF0dHJpYnV0ZSIsImFkZHJlc3MiLCJjbGFzc05hbWUiLCJhbHQiLCJpbWFnZVVybEZvclJlc3RhdXJhbnQiLCJvcGVyYXRpbmdfaG91cnMiLCJmaWxsUmVzdGF1cmFudEhvdXJzSFRNTCIsImZpbGxSZXZpZXdzSFRNTCIsIm9wZXJhdGluZ0hvdXJzIiwiaG91cnMiLCJvcGVuaW5nSG91cnMiLCJyb3ciLCJjcmVhdGVFbGVtZW50IiwiZGF5IiwiYXBwZW5kQ2hpbGQiLCJ0aW1lIiwiam9pbiIsInJldmlld3MiLCJjb250YWluZXIiLCJub1Jldmlld3MiLCJ1bCIsInJldmlldyIsImNyZWF0ZVJldmlld0hUTUwiLCJsaSIsImRhdGUiLCJyYXRpbmciLCJjb21tZW50cyIsImJyZWFkY3J1bWIiLCJsb2NhdGlvbiIsImhyZWYiLCJSZWdFeHAiLCJleGVjIiwiZGVjb2RlVVJJQ29tcG9uZW50Il0sIm1hcHBpbmdzIjoiQUFBQSxhQUVBLFNBQUFBLGdCQUFBQyxFQUFBQyxHQUFBLEtBQUFELGFBQUFDLEdBQUEsTUFBQSxJQUFBQyxVQUFBLHFDQUVBLFNBQUFDLGtCQUFBQyxFQUFBQyxHQUFBLElBQUEsSUFBQUMsRUFBQSxFQUFBQSxFQUFBRCxFQUFBRSxPQUFBRCxJQUFBLENBQUEsSUFBQUUsRUFBQUgsRUFBQUMsR0FBQUUsRUFBQUMsV0FBQUQsRUFBQUMsYUFBQSxFQUFBRCxFQUFBRSxjQUFBLEVBQUEsVUFBQUYsSUFBQUEsRUFBQUcsVUFBQSxHQUFBQyxPQUFBQyxlQUFBVCxFQUFBSSxFQUFBTSxJQUFBTixJQUVBLFNBQUFPLGFBQUFkLEVBQUFlLEVBQUFDLEdBQUEsT0FBQUQsR0FBQWIsa0JBQUFGLEVBQUFpQixVQUFBRixHQUFBQyxHQUFBZCxrQkFBQUYsRUFBQWdCLEdBQUFoQixFQUtBLElDVEFrQixXQUNBQyxJRFFBQyxTQUVBLFdBQ0EsU0FBQUEsSUFDQXRCLGdCQUFBdUIsS0FBQUQsR0E0UUEsT0F6UUFOLGFBQUFNLEVBQUEsS0FBQSxDQUFBLENBQ0FQLElBQUEsY0FDQVMsTUFBQSxXQUNBLE9BQUFDLFVBQUFDLGNBSUFDLElBQUFDLEtBQUEsaUJBQUEsRUFBQSxTQUFBQyxHQUNBQSxFQUFBQyxrQkFBQSxlQUFBLENBQ0FDLFFBQUEsT0FFQUMsWUFBQSxLQUFBLFFBUEFDLFFBQUFDLFVBVUEsQ0FDQW5CLElBQUEsZUFLQVMsTUFBQSxTQUFBVyxHQWlCQSxPQWZBQSxFQUFBQyxJQUVBZCxFQUFBZSxjQUFBQyxLQUFBLFNBQUFDLEdBQ0EsSUFBQUEsRUFBQSxNQUFBQyxNQUFBTCxFQUFBTSxZQUNBLElBQ0FDLEVBREFILEVBQUFJLFlBQUEsZUFBQSxh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c0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvblwiKTsgfSB9XG5cbmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKFwidmFsdWVcIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH1cblxuZnVuY3Rpb24gX2NyZWF0ZUNsYXNzKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH1cblxuLyoqXHJcbiAqIENvbW1vbiBkYXRhYmFzZSBoZWxwZXIgZnVuY3Rpb25zLlxyXG4gKi9cbnZhciBEQkhlbHBlciA9XG4vKiNfX1BVUkVfXyovXG5mdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIERCSGVscGVyKCkge1xuICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBEQkhlbHBlcik7XG4gIH1cblxuICBfY3JlYXRlQ2xhc3MoREJIZWxwZXIsIG51bGwsIFt7XG4gICAga2V5OiBcImlkYkRhdGFiYXNlXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGlkYkRhdGFiYXNlKCkge1xuICAgICAgaWYgKCFuYXZpZ2F0b3Iuc2VydmljZVdvcmtlcikge1xuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gaWRiLm9wZW4oJ213cy1yZXN0YXVyYW50JywgMSwgZnVuY3Rpb24gKHVwZ3JhZGVEQikge1xuICAgICAgICB2YXIgcmVzdGF1cmFudERiID0gdXBncmFkZURCLmNyZWF0ZU9iamVjdFN0b3JlKCdyZXN0YXVyYW50RGInLCB7XG4gICAgICAgICAga2V5UGF0aDogJ2lkJ1xuICAgICAgICB9KTtcbiAgICAgICAgcmVzdGF1cmFudERiLmNyZWF0ZUluZGV4KCdpZCcsICdpZCcpO1xuICAgICAgfSk7XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiBcImhhbmRsZUVycm9yc1wiLFxuXG4gICAgLyoqXHJcbiAgICAgKiBGZXRjaCBhbGwgcmVzdGF1cmFudHMuXHJcbiAgICAgKi9cbiAgICB2YWx1ZTogZnVuY3Rpb24gaGFuZGxlRXJyb3JzKHJlc3BvbnNlKSB7XG4gICAgICAvLyBJZiBOZXR3b3JrIGZhaWxlZFxuICAgICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgICAvLyBPcGVuIERhdGFiYXNlIGFuZCBnZXQgdXJsIHJlZmVyZW5jZSBmcm9tIGlkYlxuICAgICAgICBEQkhlbHBlci5pZGJEYXRhYmFzZSgpLnRoZW4oZnVuY3Rpb24gKGRiKSB7XG4gICAgICAgICAgaWYgKCFkYikgdGhyb3cgRXJyb3IocmVzcG9uc2Uuc3RhdHVzVGV4dCk7XG4gICAgICAgICAgdmFyIHR4ID0gZGIudHJhbnNhY3Rpb24oJ3Jlc3RhdXJhbnREYicsICdyZWFkd3JpdGUnKTtcbiAgICAgICAgICB2YXIgc3RvcmUgPSB0eC5vYmplY3RTdG9yZSgncmVzdGF1cmFudERiJyk7XG5cbiAgICAgICAgICBpZiAoc3RvcmUuZ2V0QWxsKCkgPD0gMCkge1xuICAgICAgICAgICAgdGhyb3cgRXJyb3IocmVzcG9uc2Uuc3RhdHVzVGV4dCk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcmV0dXJuIHN0b3JlLmdldEFsbCgpO1xuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKTtcbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6IFwiZmV0Y2hSZXN0YXVyYW50c1wiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBmZXRjaFJlc3RhdXJhbnRzKGNhbGxiYWNrKSB7XG4gICAgICByZXR1cm4gZmV0Y2godGhpcy5EQVRBQkFTRV9VUkwpLnRoZW4odGhpcy5oYW5kbGVFcnJvcnMpLnRoZW4oZnVuY3Rpb24gKHJlcykge1xuICAgICAgICB2YXIgcmVzdGF1cmFudHMgPSByZXM7IC8vIFN0b3JlIEZldGNoZWQgUmVxdWVzdCBpbiBpZGJcblxuICAgICAgICBEQkhlbHBlci5pZGJEYXRhYmFzZSgpLnRoZW4oZnVuY3Rpb24gKGRiKSB7XG4gICAgICAgICAgaWYgKCFkYikgcmV0dXJuO1xuICAgICAgICAgIHZhciB0eCA9IGRiLnRyYW5zYWN0aW9uKCdyZXN0YXVyYW50RGInLCAncmVhZHdyaXRlJyk7XG4gICAgICAgICAgdmFyIHN0b3JlID0gdHgub2JqZWN0U3RvcmUoJ3Jlc3RhdXJhbnREYicpO1xuICAgICAgICAgIHJlc3RhdXJhbnRzLmZvckVhY2goZnVuY3Rpb24gKHJlc3RhdXJhbnQpIHtcbiAgICAgICAgICAgIHN0b3JlLnB1dChyZXN0YXVyYW50KTtcbiAgICAgICAgICB9KTsgLy8gbGltaXQgc3RvcmUgdG8gMzAgaXRlbXNcblxuICAgICAgICAgIHZhciBkYXRhID0gc3RvcmUuaW5kZXgoJ2lkJykub3BlbkN1cnNvcihudWxsLCBcInByZXZcIikudGhlbihmdW5jdGlvbiAoY3Vyc29yKSB7XG4gICAgICAgICAgICByZXR1cm4gY3Vyc29yLmFkdmFuY2UoMzApO1xuICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gZGVsZXRlUmVzdChjdXJzb3IpIHtcbiAgICAgICAgICAgIGlmICghY3Vyc29yKSByZXR1cm47XG4gICAgICAgICAgICBjdXJzb3IuZGVsZXRlKCk7XG4gICAgICAgICAgICByZXR1cm4gY3Vyc29yLmNvbnRpbnVlKCkudGhlbihkZWxldGVSZXN0KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICByZXR1cm4gc3RvcmUuZ2V0QWxsKCk7IC8vIFJldHVybiBTdG9yZWQgRGF0YVxuICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXN0YXVyYW50cykge1xuICAgICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3RhdXJhbnRzKTtcbiAgICAgICAgICByZXR1cm4gcmVzdGF1cmFudHM7XG4gICAgICAgIH0pO1xuICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xuICAgICAgICByZXR1cm4gY29uc29sZS5sb2coZXJyKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgICAvKipcclxuICAgICAqIEZldGNoIGEgcmVzdGF1cmFudCBieSBpdHMgSUQuXHJcbiAgICAgKi9cblxuICB9LCB7XG4gICAga2V5OiBcImZldGNoUmVzdGF1cmFudEJ5SWRcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gZmV0Y2hSZXN0YXVyYW50QnlJZChpZCwgY2FsbGJhY2spIHtcbiAgICAgIC8vIGZldGNoIGFsbCByZXN0YXVyYW50cyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cbiAgICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoZnVuY3Rpb24gKGVycm9yLCByZXN0YXVyYW50cykge1xuICAgICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdmFyIHJlc3RhdXJhbnQgPSByZXN0YXVyYW50cy5maW5kKGZ1bmN0aW9uIChyKSB7XG4gICAgICAgICAgICByZXR1cm4gci5pZCA9PSBpZDtcbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIGlmIChyZXN0YXVyYW50KSB7XG4gICAgICAgICAgICAvLyBHb3QgdGhlIHJlc3RhdXJhbnRcbiAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3RhdXJhbnQpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBSZXN0YXVyYW50IGRvZXMgbm90IGV4aXN0IGluIHRoZSBkYXRhYmFzZVxuICAgICAgICAgICAgY2FsbGJhY2soJ1Jlc3RhdXJhbnQgZG9lcyBub3QgZXhpc3QnLCBudWxsKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgICAvKipcclxuICAgICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgY3Vpc2luZSB0eXBlIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAgICovXG5cbiAgfSwge1xuICAgIGtleTogXCJmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lKGN1aXNpbmUsIGNhbGxiYWNrKSB7XG4gICAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHMgIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nXG4gICAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKGZ1bmN0aW9uIChlcnJvciwgcmVzdGF1cmFudHMpIHtcbiAgICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIEZpbHRlciByZXN0YXVyYW50cyB0byBoYXZlIG9ubHkgZ2l2ZW4gY3Vpc2luZSB0eXBlXG4gICAgICAgICAgdmFyIHJlc3VsdHMgPSByZXN0YXVyYW50cy5maWx0ZXIoZnVuY3Rpb24gKHIpIHtcbiAgICAgICAgICAgIHJldHVybiByLmN1aXNpbmVfdHlwZSA9PSBjdWlzaW5lO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdHMpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gICAgLyoqXHJcbiAgICAgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIG5laWdoYm9yaG9vZCB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgICAqL1xuXG4gIH0sIHtcbiAgICBrZXk6IFwiZmV0Y2hSZXN0YXVyYW50QnlOZWlnaGJvcmhvb2RcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gZmV0Y2hSZXN0YXVyYW50QnlOZWlnaGJvcmhvb2QobmVpZ2hib3Job29kLCBjYWxsYmFjaykge1xuICAgICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXG4gICAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKGZ1bmN0aW9uIChlcnJvciwgcmVzdGF1cmFudHMpIHtcbiAgICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIEZpbHRlciByZXN0YXVyYW50cyB0byBoYXZlIG9ubHkgZ2l2ZW4gbmVpZ2hib3Job29kXG4gICAgICAgICAgdmFyIHJlc3VsdHMgPSByZXN0YXVyYW50cy5maWx0ZXIoZnVuY3Rpb24gKHIpIHtcbiAgICAgICAgICAgIHJldHVybiByLm5laWdoYm9yaG9vZCA9PSBuZWlnaGJvcmhvb2Q7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0cyk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgICAvKipcclxuICAgICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgY3Vpc2luZSBhbmQgYSBuZWlnaGJvcmhvb2Qgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICAgKi9cblxuICB9LCB7XG4gICAga2V5OiBcImZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZUFuZE5laWdoYm9yaG9vZFwiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2QoY3Vpc2luZSwgbmVpZ2hib3Job29kLCBjYWxsYmFjaykge1xuICAgICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXG4gICAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKGZ1bmN0aW9uIChlcnJvciwgcmVzdGF1cmFudHMpIHtcbiAgICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHZhciByZXN1bHRzID0gcmVzdGF1cmFudHM7XG5cbiAgICAgICAgICBpZiAoY3Vpc2luZSAhPSAnYWxsJykge1xuICAgICAgICAgICAgLy8gZmlsdGVyIGJ5IGN1aXNpbmVcbiAgICAgICAgICAgIHJlc3VsdHMgPSByZXN1bHRzLmZpbHRlcihmdW5jdGlvbiAocikge1xuICAgICAgICAgICAgICByZXR1cm4gci5jdWlzaW5lX3R5cGUgPT0gY3Vpc2luZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmIChuZWlnaGJvcmhvb2QgIT0gJ2FsbCcpIHtcbiAgICAgICAgICAgIC8vIGZpbHRlciBieSBuZWlnaGJvcmhvb2RcbiAgICAgICAgICAgIHJlc3VsdHMgPSByZXN1bHRzLmZpbHRlcihmdW5jdGlvbiAocikge1xuICAgICAgICAgICAgICByZXR1cm4gci5uZWlnaGJvcmhvb2QgPT0gbmVpZ2hib3Job29kO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0cyk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgICAvKipcclxuICAgICAqIEZldGNoIGFsbCBuZWlnaGJvcmhvb2RzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAgICovXG5cbiAgfSwge1xuICAgIGtleTogXCJmZXRjaE5laWdoYm9yaG9vZHNcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gZmV0Y2hOZWlnaGJvcmhvb2RzKGNhbGxiYWNrKSB7XG4gICAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcbiAgICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoZnVuY3Rpb24gKGVycm9yLCByZXN0YXVyYW50cykge1xuICAgICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gR2V0IGFsbCBuZWlnaGJvcmhvb2RzIGZyb20gYWxsIHJlc3RhdXJhbnRzXG4gICAgICAgICAgdmFyIG5laWdoYm9yaG9vZHMgPSByZXN0YXVyYW50cy5tYXAoZnVuY3Rpb24gKHYsIGkpIHtcbiAgICAgICAgICAgIHJldHVybiByZXN0YXVyYW50c1tpXS5uZWlnaGJvcmhvb2Q7XG4gICAgICAgICAgfSk7IC8vIFJlbW92ZSBkdXBsaWNhdGVzIGZyb20gbmVpZ2hib3Job29kc1xuXG4gICAgICAgICAgdmFyIHVuaXF1ZU5laWdoYm9yaG9vZHMgPSBuZWlnaGJvcmhvb2RzLmZpbHRlcihmdW5jdGlvbiAodiwgaSkge1xuICAgICAgICAgICAgcmV0dXJuIG5laWdoYm9yaG9vZHMuaW5kZXhPZih2KSA9PSBpO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIGNhbGxiYWNrKG51bGwsIHVuaXF1ZU5laWdoYm9yaG9vZHMpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gICAgLyoqXHJcbiAgICAgKiBGZXRjaCBhbGwgY3Vpc2luZXMgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICAgKi9cblxuICB9LCB7XG4gICAga2V5OiBcImZldGNoQ3Vpc2luZXNcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gZmV0Y2hDdWlzaW5lcyhjYWxsYmFjaykge1xuICAgICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXG4gICAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKGZ1bmN0aW9uIChlcnJvciwgcmVzdGF1cmFudHMpIHtcbiAgICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIEdldCBhbGwgY3Vpc2luZXMgZnJvbSBhbGwgcmVzdGF1cmFudHNcbiAgICAgICAgICB2YXIgY3Vpc2luZXMgPSByZXN0YXVyYW50cy5tYXAoZnVuY3Rpb24gKHYsIGkpIHtcbiAgICAgICAgICAgIHJldHVybiByZXN0YXVyYW50c1tpXS5jdWlzaW5lX3R5cGU7XG4gICAgICAgICAgfSk7IC8vIFJlbW92ZSBkdXBsaWNhdGVzIGZyb20gY3Vpc2luZXNcblxuICAgICAgICAgIHZhciB1bmlxdWVDdWlzaW5lcyA9IGN1aXNpbmVzLmZpbHRlcihmdW5jdGlvbiAodiwgaSkge1xuICAgICAgICAgICAgcmV0dXJuIGN1aXNpbmVzLmluZGV4T2YodikgPT0gaTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBjYWxsYmFjayhudWxsLCB1bmlxdWVDdWlzaW5lcyk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgICAvKipcclxuICAgICAqIFJlc3RhdXJhbnQgcGFnZSBVUkwuXHJcbiAgICAgKi9cblxuICB9LCB7XG4gICAga2V5OiBcInVybEZvclJlc3RhdXJhbnRcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gdXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSB7XG4gICAgICByZXR1cm4gXCIuL3Jlc3RhdXJhbnQuaHRtbD9pZD1cIi5jb25jYXQocmVzdGF1cmFudC5pZCk7XG4gICAgfVxuICAgIC8qKlxyXG4gICAgICogUmVzdGF1cmFudCBpbWFnZSBVUkwuXHJcbiAgICAgKi9cblxuICB9LCB7XG4gICAga2V5OiBcImltYWdlVXJsRm9yUmVzdGF1cmFudFwiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBpbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCkge1xuICAgICAgcmV0dXJuIFwiL2ltZy9cIi5jb25jYXQocmVzdGF1cmFudC5waG90b2dyYXBoLCBcIi5qcGdcIik7XG4gICAgfVxuICAgIC8qKlxyXG4gICAgICogTWFwIG1hcmtlciBmb3IgYSByZXN0YXVyYW50LlxyXG4gICAgICovXG5cbiAgfSwge1xuICAgIGtleTogXCJtYXBNYXJrZXJGb3JSZXN0YXVyYW50XCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIG1hcE1hcmtlckZvclJlc3RhdXJhbnQocmVzdGF1cmFudCwgbWFwKSB7XG4gICAgICB2YXIgbWFya2VyID0gbmV3IGdvb2dsZS5tYXBzLk1hcmtlcih7XG4gICAgICAgIHBvc2l0aW9uOiByZXN0YXVyYW50LmxhdGxuZyxcbiAgICAgICAgdGl0bGU6IHJlc3RhdXJhbnQubmFtZSxcbiAgICAgICAgdXJsOiBEQkhlbHBlci51cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpLFxuICAgICAgICBtYXA6IG1hcCxcbiAgICAgICAgYW5pbWF0aW9uOiBnb29nbGUubWFwcy5BbmltYXRpb24uRFJPUFxuICAgICAgfSk7XG4gICAgICBtYXJrZXIudGFiaW5kZXggPSAtMTtcbiAgICAgIHJldHVybiBtYXJrZXI7XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiBcIkRBVEFCQVNFX1VSTFwiLFxuXG4gICAgLyoqXHJcbiAgICAgKiBEYXRhYmFzZSBVUkwuXHJcbiAgICAgKiBDaGFuZ2UgdGhpcyB0byByZXN0YXVyYW50cy5qc29uIGZpbGUgbG9jYXRpb24gb24geW91ciBzZXJ2ZXIuXHJcbiAgICAgKi9cbiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHtcbiAgICAgIHZhciBwb3J0ID0gODA4MDsgLy8gQ2hhbmdlIHRoaXMgdG8geW91ciBzZXJ2ZXIgcG9ydFxuXG4gICAgICB2YXIgdXJsID0gJ2h0dHA6Ly9sb2NhbGhvc3Q6MTMzNy9yZXN0YXVyYW50cyc7XG4gICAgICByZXR1cm4gdXJsO1xuICAgIH1cbiAgfV0pO1xuXG4gIHJldHVybiBEQkhlbHBlcjtcbn0oKTsiLCJcInVzZSBzdHJpY3RcIjtcblxudmFyIHJlc3RhdXJhbnQ7XG52YXIgbWFwO1xuLyoqXG4gKiBJbml0aWFsaXplIEdvb2dsZSBtYXAsIGNhbGxlZCBmcm9tIEhUTUwuXG4gKi9cblxud2luZG93LmluaXRNYXAgPSBmdW5jdGlvbiAoKSB7XG4gIGZldGNoUmVzdGF1cmFudEZyb21VUkwoZnVuY3Rpb24gKGVycm9yLCByZXN0YXVyYW50KSB7XG4gICAgaWYgKGVycm9yKSB7XG4gICAgICAvLyBHb3QgYW4gZXJyb3IhXG4gICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc2VsZi5tYXAgPSBuZXcgZ29vZ2xlLm1hcHMuTWFwKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAnKSwge1xuICAgICAgICB6b29tOiAxNixcbiAgICAgICAgY2VudGVyOiByZXN0YXVyYW50LmxhdGxuZyxcbiAgICAgICAgc2Nyb2xsd2hlZWw6IGZhbHNlXG4gICAgICB9KTtcbiAgICAgIGZpbGxCcmVhZGNydW1iKCk7XG4gICAgICBEQkhlbHBlci5tYXBNYXJrZXJGb3JSZXN0YXVyYW50KHNlbGYucmVzdGF1cmFudCwgc2VsZi5tYXApO1xuICAgIH1cbiAgfSk7XG59O1xuLyoqXG4gKiBHZXQgY3VycmVudCByZXN0YXVyYW50IGZyb20gcGFnZSBVUkwuXG4gKi9cblxuXG52YXIgZmV0Y2hSZXN0YXVyYW50RnJvbVVSTCA9IGZ1bmN0aW9uIGZldGNoUmVzdGF1cmFudEZyb21VUkwoY2FsbGJhY2spIHtcbiAgaWYgKHNlbGYucmVzdGF1cmFudCkge1xuICAgIC8vIHJlc3RhdXJhbnQgYWxyZWFkeSBmZXRjaGVkIVxuICAgIGNhbGxiYWNrKG51bGwsIHNlbGYucmVzdGF1cmFudCk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIGlkID0gZ2V0UGFyYW1ldGVyQnlOYW1lKCdpZCcpO1xuXG4gIGlmICghaWQpIHtcbiAgICAvLyBubyBpZCBmb3VuZCBpbiBVUkxcbiAgICBlcnJvciA9ICdObyByZXN0YXVyYW50IGlkIGluIFVSTCc7XG4gICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xuICB9IGVsc2Uge1xuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudEJ5SWQoaWQsIGZ1bmN0aW9uIChlcnJvciwgcmVzdGF1cmFudCkge1xuICAgICAgc2VsZi5yZXN0YXVyYW50ID0gcmVzdGF1cmFudDtcblxuICAgICAgaWYgKCFyZXN0YXVyYW50KSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGZpbGxSZXN0YXVyYW50SFRNTCgpO1xuICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdGF1cmFudCk7XG4gICAgfSk7XG4gIH1cbn07XG4vKipcbiAqIENyZWF0ZSByZXN0YXVyYW50IEhUTUwgYW5kIGFkZCBpdCB0byB0aGUgd2VicGFnZVxuICovXG5cblxudmFyIGZpbGxSZXN0YXVyYW50SFRNTCA9IGZ1bmN0aW9uIGZpbGxSZXN0YXVyYW50SFRNTCgpIHtcbiAgdmFyIHJlc3RhdXJhbnQgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IHNlbGYucmVzdGF1cmFudDtcbiAgdmFyIG5hbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1uYW1lJyk7XG4gIG5hbWUuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uYW1lO1xuICBuYW1lLnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsIFwicmVzdGF1cmFudCBuYW1lOiBcIi5jb25jYXQocmVzdGF1cmFudC5uYW1lKSk7XG4gIHZhciBhZGRyZXNzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtYWRkcmVzcycpO1xuICBhZGRyZXNzLmlubmVySFRNTCA9IHJlc3RhdXJhbnQuYWRkcmVzcztcbiAgYWRkcmVzcy5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCBcInJlc3RhdXJhbnQgYWRkcmVzczogXCIuY29uY2F0KHJlc3RhdXJhbnQuYWRkcmVzcykpO1xuICB2YXIgaW1hZ2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1pbWcnKTtcbiAgaW1hZ2UuY2xhc3NOYW1lID0gJ3Jlc3RhdXJhbnQtaW1nIGxhenknO1xuICBpbWFnZS5hbHQgPSByZXN0YXVyYW50Lm5hbWU7IC8vIGltYWdlLnNyYyA9IERCSGVscGVyLmltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KTtcblxuICBpbWFnZS5zZXRBdHRyaWJ1dGUoJ3NyYycsICcgJyk7XG4gIGltYWdlLnNldEF0dHJpYnV0ZSgnZGF0YS1zcmMnLCBEQkhlbHBlci5pbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCkpO1xuICB2YXIgY3Vpc2luZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWN1aXNpbmUnKTtcbiAgY3Vpc2luZS5pbm5lckhUTUwgPSByZXN0YXVyYW50LmN1aXNpbmVfdHlwZTtcbiAgY3Vpc2luZS5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCBcImN1aXNpbmUgdHlwZTogXCIuY29uY2F0KHJlc3RhdXJhbnQuY3Vpc2luZV90eXBlKSk7IC8vIGZpbGwgb3BlcmF0aW5nIGhvdXJzXG5cbiAgaWYgKHJlc3RhdXJhbnQub3BlcmF0aW5nX2hvdXJzKSB7XG4gICAgZmlsbFJlc3RhdXJhbnRIb3Vyc0hUTUwoKTtcbiAgfSAvLyBmaWxsIHJldmlld3NcblxuXG4gIGZpbGxSZXZpZXdzSFRNTCgpO1xuICBsYXp5TG9hZGVyKCk7IC8vIExhenkgTG9hZCBJbWFnZXNcbiAgLy8gW10uZm9yRWFjaC5jYWxsKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ2ltZ1tkYXRhLXNyY10nKSwgZnVuY3Rpb24oaW1nKSB7XG4gIC8vIFx0aW1nLnNldEF0dHJpYnV0ZSgnc3JjJywgaW1nLmdldEF0dHJpYnV0ZSgnZGF0YS1zcmMnKSk7XG4gIC8vIFx0aW1nLm9ubG9hZCA9IGZ1bmN0aW9uKCkge1xuICAvLyAgICAgICBjb25zb2xlLmxvZyhpbWcuZ2V0QXR0cmlidXRlKCdkYXRhLXNyYycpKVxuICAvLyBcdFx0aW1nLnJlbW92ZUF0dHJpYnV0ZSgnZGF0YS1zcmMnKTtcbiAgLy8gXHR9O1xuICAvLyB9KTtcbn07XG4vKipcbiAqIENyZWF0ZSByZXN0YXVyYW50IG9wZXJhdGluZyBob3VycyBIVE1MIHRhYmxlIGFuZCBhZGQgaXQgdG8gdGhlIHdlYnBhZ2UuXG4gKi9cblxuXG52YXIgZmlsbFJlc3RhdXJhbnRIb3Vyc0hUTUwgPSBmdW5jdGlvbiBmaWxsUmVzdGF1cmFudEhvdXJzSFRNTCgpIHtcbiAgdmFyIG9wZXJhdGluZ0hvdXJzID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiBzZWxmLnJlc3RhdXJhbnQub3BlcmF0aW5nX2hvdXJzO1xuICB2YXIgaG91cnMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1ob3VycycpO1xuICB2YXIgb3BlbmluZ0hvdXJzID0gW107XG5cbiAgZm9yICh2YXIga2V5IGluIG9wZXJhdGluZ0hvdXJzKSB7XG4gICAgdmFyIHJvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJyk7XG4gICAgdmFyIGRheSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7XG4gICAgZGF5LmlubmVySFRNTCA9IGtleTtcbiAgICByb3cuYXBwZW5kQ2hpbGQoZGF5KTtcbiAgICB2YXIgdGltZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7XG4gICAgdGltZS5pbm5lckhUTUwgPSBvcGVyYXRpbmdIb3Vyc1trZXldO1xuICAgIHJvdy5hcHBlbmRDaGlsZCh0aW1lKTtcbiAgICBob3Vycy5hcHBlbmRDaGlsZChyb3cpO1xuICAgIG9wZW5pbmdIb3Vycy5wdXNoKFwiXCIuY29uY2F0KGtleSwgXCIgXCIpLmNvbmNhdChvcGVyYXRpbmdIb3Vyc1trZXldLCBcIiBcIikpO1xuICB9XG5cbiAgY29uc29sZS5sb2cob3BlbmluZ0hvdXJzKTtcbiAgaG91cnMuc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgXCJSZXN0YXJ1YW50IEhvdXJzIFwiLmNvbmNhdChvcGVuaW5nSG91cnMuam9pbignLiAnKS5yZXBsYWNlKC8tL2csICd0bycpKSk7XG59O1xuLyoqXG4gKiBDcmVhdGUgYWxsIHJldmlld3MgSFRNTCBhbmQgYWRkIHRoZW0gdG8gdGhlIHdlYnBhZ2UuXG4gKi9cblxuXG52YXIgZmlsbFJldmlld3NIVE1MID0gZnVuY3Rpb24gZmlsbFJldmlld3NIVE1MKCkge1xuICB2YXIgcmV2aWV3cyA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogc2VsZi5yZXN0YXVyYW50LnJldmlld3M7XG4gIHZhciBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmV2aWV3cy1jb250YWluZXInKTtcbiAgdmFyIHRpdGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaDMnKTtcbiAgdGl0bGUuaW5uZXJIVE1MID0gJ1Jldmlld3MnO1xuICBjb250YWluZXIuYXBwZW5kQ2hpbGQodGl0bGUpO1xuXG4gIGlmICghcmV2aWV3cykge1xuICAgIHZhciBub1Jldmlld3MgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gICAgbm9SZXZpZXdzLmlubmVySFRNTCA9ICdObyByZXZpZXdzIHlldCEnO1xuICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChub1Jldmlld3MpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciB1bCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXZpZXdzLWxpc3QnKTtcbiAgcmV2aWV3cy5mb3JFYWNoKGZ1bmN0aW9uIChyZXZpZXcpIHtcbiAgICB1bC5hcHBlbmRDaGlsZChjcmVhdGVSZXZpZXdIVE1MKHJldmlldykpO1xuICB9KTtcbiAgY29udGFpbmVyLmFwcGVuZENoaWxkKHVsKTtcbn07XG4vKipcbiAqIENyZWF0ZSByZXZpZXcgSFRNTCBhbmQgYWRkIGl0IHRvIHRoZSB3ZWJwYWdlLlxuICovXG5cblxudmFyIGNyZWF0ZVJldmlld0hUTUwgPSBmdW5jdGlvbiBjcmVhdGVSZXZpZXdIVE1MKHJldmlldykge1xuICB2YXIgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xuICB2YXIgbmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgbmFtZS5pbm5lckhUTUwgPSByZXZpZXcubmFtZTtcbiAgbGkuYXBwZW5kQ2hpbGQobmFtZSk7XG4gIHZhciBkYXRlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICBkYXRlLmlubmVySFRNTCA9IHJldmlldy5kYXRlO1xuICBkYXRlLnNldEF0dHJpYnV0ZSgndGFiaW5kZXgnLCAnMCcpO1xuICBsaS5hcHBlbmRDaGlsZChkYXRlKTtcbiAgdmFyIHJhdGluZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgcmF0aW5nLmlubmVySFRNTCA9IFwiUmF0aW5nOiBcIi5jb25jYXQocmV2aWV3LnJhdGluZyk7XG4gIHJhdGluZy5zZXRBdHRyaWJ1dGUoJ3RhYmluZGV4JywgJzAnKTtcbiAgbGkuYXBwZW5kQ2hpbGQocmF0aW5nKTtcbiAgdmFyIGNvbW1lbnRzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICBjb21tZW50cy5pbm5lckhUTUwgPSByZXZpZXcuY29tbWVudHM7XG4gIGNvbW1lbnRzLnNldEF0dHJpYnV0ZSgndGFiaW5kZXgnLCAnMCcpO1xuICBsaS5hcHBlbmRDaGlsZChjb21tZW50cyk7XG4gIGxpLnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsIFwicmV2aWV3IGJ5IFwiLmNvbmNhdChyZXZpZXcubmFtZSkpO1xuICBsaS5zZXRBdHRyaWJ1dGUoJ3RhYmluZGV4JywgJzAnKTtcbiAgcmV0dXJuIGxpO1xufTtcbi8qKlxuICogQWRkIHJlc3RhdXJhbnQgbmFtZSB0byB0aGUgYnJlYWRjcnVtYiBuYXZpZ2F0aW9uIG1lbnVcbiAqL1xuXG5cbnZhciBmaWxsQnJlYWRjcnVtYiA9IGZ1bmN0aW9uIGZpbGxCcmVhZGNydW1iKCkge1xuICB2YXIgcmVzdGF1cmFudCA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogc2VsZi5yZXN0YXVyYW50O1xuICB2YXIgYnJlYWRjcnVtYiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdicmVhZGNydW1iJyk7XG4gIHZhciBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XG4gIGxpLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmFtZTtcbiAgYnJlYWRjcnVtYi5hcHBlbmRDaGlsZChsaSk7XG59O1xuLyoqXG4gKiBHZXQgYSBwYXJhbWV0ZXIgYnkgbmFtZSBmcm9tIHBhZ2UgVVJMLlxuICovXG5cblxudmFyIGdldFBhcmFtZXRlckJ5TmFtZSA9IGZ1bmN0aW9uIGdldFBhcmFtZXRlckJ5TmFtZShuYW1lLCB1cmwpIHtcbiAgaWYgKCF1cmwpIHVybCA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmO1xuICBuYW1lID0gbmFtZS5yZXBsYWNlKC9bXFxbXFxdXS9nLCAnXFxcXCQmJyk7XG4gIHZhciByZWdleCA9IG5ldyBSZWdFeHAoXCJbPyZdXCIuY29uY2F0KG5hbWUsIFwiKD0oW14mI10qKXwmfCN8JClcIikpLFxuICAgICAgcmVzdWx0cyA9IHJlZ2V4LmV4ZWModXJsKTtcbiAgaWYgKCFyZXN1bHRzKSByZXR1cm4gbnVsbDtcbiAgaWYgKCFyZXN1bHRzWzJdKSByZXR1cm4gJyc7XG4gIHJldHVybiBkZWNvZGVVUklDb21wb25lbnQocmVzdWx0c1syXS5yZXBsYWNlKC9cXCsvZywgJyAnKSk7XG59OyIsIlwidXNlIHN0cmljdFwiO1xuXG5mdW5jdGlvbiBsYXp5TG9hZGVyKCkge1xuICBjb25zb2xlLmxvZygnZXhlY3V0aW5nIGxhenkgbG9hZGluZycpO1xuICB2YXIgbGF6eUltYWdlcyA9IFtdLnNsaWNlLmNhbGwoZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcImltZy5sYXp5XCIpKTtcbiAgdmFyIGFjdGl2ZSA9IGZhbHNlO1xuXG4gIHZhciBsYXp5TG9hZCA9IGZ1bmN0aW9uIGxhenlMb2FkKCkge1xuICAgIGlmIChhY3RpdmUgPT09IGZhbHNlKSB7XG4gICAgICBhY3RpdmUgPSB0cnVlO1xuICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgIGxhenlJbWFnZXMuZm9yRWFjaChmdW5jdGlvbiAobGF6eUltYWdlKSB7XG4gICAgICAgICAgaWYgKGxhenlJbWFnZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS50b3AgPD0gd2luZG93LmlubmVySGVpZ2h0ICYmIGxhenlJbWFnZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5ib3R0b20gPj0gMCAmJiBnZXRDb21wdXRlZFN0eWxlKGxhenlJbWFnZSkuZGlzcGxheSAhPT0gXCJub25lXCIpIHtcbiAgICAgICAgICAgIGxhenlJbWFnZS5zcmMgPSBsYXp5SW1hZ2UuZ2V0QXR0cmlidXRlKCdkYXRhLXNyYycpOyAvLyBsYXp5SW1hZ2Uuc3Jjc2V0ID0gbGF6eUltYWdlLmRhdGFzZXQuc3Jjc2V0O1xuXG4gICAgICAgICAgICBsYXp5SW1hZ2UuY2xhc3NMaXN0LnJlbW92ZShcImxhenlcIik7XG4gICAgICAgICAgICBsYXp5SW1hZ2VzID0gbGF6eUltYWdlcy5maWx0ZXIoZnVuY3Rpb24gKGltYWdlKSB7XG4gICAgICAgICAgICAgIHJldHVybiBpbWFnZSAhPT0gbGF6eUltYWdlO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGlmIChsYXp5SW1hZ2VzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwic2Nyb2xsXCIsIGxhenlMb2FkKTtcbiAgICAgICAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJyZXNpemVcIiwgbGF6eUxvYWQpO1xuICAgICAgICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIm9yaWVudGF0aW9uY2hhbmdlXCIsIGxhenlMb2FkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBhY3RpdmUgPSBmYWxzZTtcbiAgICAgIH0sIDIwMCk7XG4gICAgfVxuICB9O1xuXG4gIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJzY3JvbGxcIiwgbGF6eUxvYWQpO1xuICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcInJlc2l6ZVwiLCBsYXp5TG9hZCk7XG4gIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwib3JpZW50YXRpb25jaGFuZ2VcIiwgbGF6eUxvYWQpO1xufSIsIid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gdG9BcnJheShhcnIpIHtcbiAgICByZXR1cm4gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJyKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb21pc2lmeVJlcXVlc3QocmVxdWVzdCkge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmVzb2x2ZShyZXF1ZXN0LnJlc3VsdCk7XG4gICAgICB9O1xuXG4gICAgICByZXF1ZXN0Lm9uZXJyb3IgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJlamVjdChyZXF1ZXN0LmVycm9yKTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBwcm9taXNpZnlSZXF1ZXN0Q2FsbChvYmosIG1ldGhvZCwgYXJncykge1xuICAgIHZhciByZXF1ZXN0O1xuICAgIHZhciBwID0gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgcmVxdWVzdCA9IG9ialttZXRob2RdLmFwcGx5KG9iaiwgYXJncyk7XG4gICAgICBwcm9taXNpZnlSZXF1ZXN0KHJlcXVlc3QpLnRoZW4ocmVzb2x2ZSwgcmVqZWN0KTtcbiAgICB9KTtcbiAgICBwLnJlcXVlc3QgPSByZXF1ZXN0O1xuICAgIHJldHVybiBwO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJvbWlzaWZ5Q3Vyc29yUmVxdWVzdENhbGwob2JqLCBtZXRob2QsIGFyZ3MpIHtcbiAgICB2YXIgcCA9IHByb21pc2lmeVJlcXVlc3RDYWxsKG9iaiwgbWV0aG9kLCBhcmdzKTtcbiAgICByZXR1cm4gcC50aGVuKGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgaWYgKCF2YWx1ZSkgcmV0dXJuO1xuICAgICAgcmV0dXJuIG5ldyBDdXJzb3IodmFsdWUsIHAucmVxdWVzdCk7XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBwcm94eVByb3BlcnRpZXMoUHJveHlDbGFzcywgdGFyZ2V0UHJvcCwgcHJvcGVydGllcykge1xuICAgIHByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbiAocHJvcCkge1xuICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFByb3h5Q2xhc3MucHJvdG90eXBlLCBwcm9wLCB7XG4gICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkge1xuICAgICAgICAgIHJldHVybiB0aGlzW3RhcmdldFByb3BdW3Byb3BdO1xuICAgICAgICB9LFxuICAgICAgICBzZXQ6IGZ1bmN0aW9uIHNldCh2YWwpIHtcbiAgICAgICAgICB0aGlzW3RhcmdldFByb3BdW3Byb3BdID0gdmFsO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb3h5UmVxdWVzdE1ldGhvZHMoUHJveHlDbGFzcywgdGFyZ2V0UHJvcCwgQ29uc3RydWN0b3IsIHByb3BlcnRpZXMpIHtcbiAgICBwcm9wZXJ0aWVzLmZvckVhY2goZnVuY3Rpb24gKHByb3ApIHtcbiAgICAgIGlmICghKHByb3AgaW4gQ29uc3RydWN0b3IucHJvdG90eXBlKSkgcmV0dXJuO1xuXG4gICAgICBQcm94eUNsYXNzLnByb3RvdHlwZVtwcm9wXSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHByb21pc2lmeVJlcXVlc3RDYWxsKHRoaXNbdGFyZ2V0UHJvcF0sIHByb3AsIGFyZ3VtZW50cyk7XG4gICAgICB9O1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJveHlNZXRob2RzKFByb3h5Q2xhc3MsIHRhcmdldFByb3AsIENvbnN0cnVjdG9yLCBwcm9wZXJ0aWVzKSB7XG4gICAgcHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uIChwcm9wKSB7XG4gICAgICBpZiAoIShwcm9wIGluIENvbnN0cnVjdG9yLnByb3RvdHlwZSkpIHJldHVybjtcblxuICAgICAgUHJveHlDbGFzcy5wcm90b3R5cGVbcHJvcF0gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzW3RhcmdldFByb3BdW3Byb3BdLmFwcGx5KHRoaXNbdGFyZ2V0UHJvcF0sIGFyZ3VtZW50cyk7XG4gICAgICB9O1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJveHlDdXJzb3JSZXF1ZXN0TWV0aG9kcyhQcm94eUNsYXNzLCB0YXJnZXRQcm9wLCBDb25zdHJ1Y3RvciwgcHJvcGVydGllcykge1xuICAgIHByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbiAocHJvcCkge1xuICAgICAgaWYgKCEocHJvcCBpbiBDb25zdHJ1Y3Rvci5wcm90b3R5cGUpKSByZXR1cm47XG5cbiAgICAgIFByb3h5Q2xhc3MucHJvdG90eXBlW3Byb3BdID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gcHJvbWlzaWZ5Q3Vyc29yUmVxdWVzdENhbGwodGhpc1t0YXJnZXRQcm9wXSwgcHJvcCwgYXJndW1lbnRzKTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBJbmRleChpbmRleCkge1xuICAgIHRoaXMuX2luZGV4ID0gaW5kZXg7XG4gIH1cblxuICBwcm94eVByb3BlcnRpZXMoSW5kZXgsICdfaW5kZXgnLCBbJ25hbWUnLCAna2V5UGF0aCcsICdtdWx0aUVudHJ5JywgJ3VuaXF1ZSddKTtcbiAgcHJveHlSZXF1ZXN0TWV0aG9kcyhJbmRleCwgJ19pbmRleCcsIElEQkluZGV4LCBbJ2dldCcsICdnZXRLZXknLCAnZ2V0QWxsJywgJ2dldEFsbEtleXMnLCAnY291bnQnXSk7XG4gIHByb3h5Q3Vyc29yUmVxdWVzdE1ldGhvZHMoSW5kZXgsICdfaW5kZXgnLCBJREJJbmRleCwgWydvcGVuQ3Vyc29yJywgJ29wZW5LZXlDdXJzb3InXSk7XG5cbiAgZnVuY3Rpb24gQ3Vyc29yKGN1cnNvciwgcmVxdWVzdCkge1xuICAgIHRoaXMuX2N1cnNvciA9IGN1cnNvcjtcbiAgICB0aGlzLl9yZXF1ZXN0ID0gcmVxdWVzdDtcbiAgfVxuXG4gIHByb3h5UHJvcGVydGllcyhDdXJzb3IsICdfY3Vyc29yJywgWydkaXJlY3Rpb24nLCAna2V5JywgJ3ByaW1hcnlLZXknLCAndmFsdWUnXSk7XG4gIHByb3h5UmVxdWVzdE1ldGhvZHMoQ3Vyc29yLCAnX2N1cnNvcicsIElEQkN1cnNvciwgWyd1cGRhdGUnLCAnZGVsZXRlJ10pOyAvLyBwcm94eSAnbmV4dCcgbWV0aG9kc1xuXG4gIFsnYWR2YW5jZScsICdjb250aW51ZScsICdjb250aW51ZVByaW1hcnlLZXknXS5mb3JFYWNoKGZ1bmN0aW9uIChtZXRob2ROYW1lKSB7XG4gICAgaWYgKCEobWV0aG9kTmFtZSBpbiBJREJDdXJzb3IucHJvdG90eXBlKSkgcmV0dXJuO1xuXG4gICAgQ3Vyc29yLnByb3RvdHlwZVttZXRob2ROYW1lXSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBjdXJzb3IgPSB0aGlzO1xuICAgICAgdmFyIGFyZ3MgPSBhcmd1bWVudHM7XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCkudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgIGN1cnNvci5fY3Vyc29yW21ldGhvZE5hbWVdLmFwcGx5KGN1cnNvci5fY3Vyc29yLCBhcmdzKTtcblxuICAgICAgICByZXR1cm4gcHJvbWlzaWZ5UmVxdWVzdChjdXJzb3IuX3JlcXVlc3QpLnRoZW4oZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgaWYgKCF2YWx1ZSkgcmV0dXJuO1xuICAgICAgICAgIHJldHVybiBuZXcgQ3Vyc29yKHZhbHVlLCBjdXJzb3IuX3JlcXVlc3QpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH07XG4gIH0pO1xuXG4gIGZ1bmN0aW9uIE9iamVjdFN0b3JlKHN0b3JlKSB7XG4gICAgdGhpcy5fc3RvcmUgPSBzdG9yZTtcbiAgfVxuXG4gIE9iamVjdFN0b3JlLnByb3RvdHlwZS5jcmVhdGVJbmRleCA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gbmV3IEluZGV4KHRoaXMuX3N0b3JlLmNyZWF0ZUluZGV4LmFwcGx5KHRoaXMuX3N0b3JlLCBhcmd1bWVudHMpKTtcbiAgfTtcblxuICBPYmplY3RTdG9yZS5wcm90b3R5cGUuaW5kZXggPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIG5ldyBJbmRleCh0aGlzLl9zdG9yZS5pbmRleC5hcHBseSh0aGlzLl9zdG9yZSwgYXJndW1lbnRzKSk7XG4gIH07XG5cbiAgcHJveHlQcm9wZXJ0aWVzKE9iamVjdFN0b3JlLCAnX3N0b3JlJywgWyduYW1lJywgJ2tleVBhdGgnLCAnaW5kZXhOYW1lcycsICdhdXRvSW5jcmVtZW50J10pO1xuICBwcm94eVJlcXVlc3RNZXRob2RzKE9iamVjdFN0b3JlLCAnX3N0b3JlJywgSURCT2JqZWN0U3RvcmUsIFsncHV0JywgJ2FkZCcsICdkZWxldGUnLCAnY2xlYXInLCAnZ2V0JywgJ2dldEFsbCcsICdnZXRLZXknLCAnZ2V0QWxsS2V5cycsICdjb3VudCddKTtcbiAgcHJveHlDdXJzb3JSZXF1ZXN0TWV0aG9kcyhPYmplY3RTdG9yZSwgJ19zdG9yZScsIElEQk9iamVjdFN0b3JlLCBbJ29wZW5DdXJzb3InLCAnb3BlbktleUN1cnNvciddKTtcbiAgcHJveHlNZXRob2RzKE9iamVjdFN0b3JlLCAnX3N0b3JlJywgSURCT2JqZWN0U3RvcmUsIFsnZGVsZXRlSW5kZXgnXSk7XG5cbiAgZnVuY3Rpb24gVHJhbnNhY3Rpb24oaWRiVHJhbnNhY3Rpb24pIHtcbiAgICB0aGlzLl90eCA9IGlkYlRyYW5zYWN0aW9uO1xuICAgIHRoaXMuY29tcGxldGUgPSBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICBpZGJUcmFuc2FjdGlvbi5vbmNvbXBsZXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXNvbHZlKCk7XG4gICAgICB9O1xuXG4gICAgICBpZGJUcmFuc2FjdGlvbi5vbmVycm9yID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZWplY3QoaWRiVHJhbnNhY3Rpb24uZXJyb3IpO1xuICAgICAgfTtcblxuICAgICAgaWRiVHJhbnNhY3Rpb24ub25hYm9ydCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmVqZWN0KGlkYlRyYW5zYWN0aW9uLmVycm9yKTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cblxuICBUcmFuc2FjdGlvbi5wcm90b3R5cGUub2JqZWN0U3RvcmUgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIG5ldyBPYmplY3RTdG9yZSh0aGlzLl90eC5vYmplY3RTdG9yZS5hcHBseSh0aGlzLl90eCwgYXJndW1lbnRzKSk7XG4gIH07XG5cbiAgcHJveHlQcm9wZXJ0aWVzKFRyYW5zYWN0aW9uLCAnX3R4JywgWydvYmplY3RTdG9yZU5hbWVzJywgJ21vZGUnXSk7XG4gIHByb3h5TWV0aG9kcyhUcmFuc2FjdGlvbiwgJ190eCcsIElEQlRyYW5zYWN0aW9uLCBbJ2Fib3J0J10pO1xuXG4gIGZ1bmN0aW9uIFVwZ3JhZGVEQihkYiwgb2xkVmVyc2lvbiwgdHJhbnNhY3Rpb24pIHtcbiAgICB0aGlzLl9kYiA9IGRiO1xuICAgIHRoaXMub2xkVmVyc2lvbiA9IG9sZFZlcnNpb247XG4gICAgdGhpcy50cmFuc2FjdGlvbiA9IG5ldyBUcmFuc2FjdGlvbih0cmFuc2FjdGlvbik7XG4gIH1cblxuICBVcGdyYWRlREIucHJvdG90eXBlLmNyZWF0ZU9iamVjdFN0b3JlID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBuZXcgT2JqZWN0U3RvcmUodGhpcy5fZGIuY3JlYXRlT2JqZWN0U3RvcmUuYXBwbHkodGhpcy5fZGIsIGFyZ3VtZW50cykpO1xuICB9O1xuXG4gIHByb3h5UHJvcGVydGllcyhVcGdyYWRlREIsICdfZGInLCBbJ25hbWUnLCAndmVyc2lvbicsICdvYmplY3RTdG9yZU5hbWVzJ10pO1xuICBwcm94eU1ldGhvZHMoVXBncmFkZURCLCAnX2RiJywgSURCRGF0YWJhc2UsIFsnZGVsZXRlT2JqZWN0U3RvcmUnLCAnY2xvc2UnXSk7XG5cbiAgZnVuY3Rpb24gREIoZGIpIHtcbiAgICB0aGlzLl9kYiA9IGRiO1xuICB9XG5cbiAgREIucHJvdG90eXBlLnRyYW5zYWN0aW9uID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBuZXcgVHJhbnNhY3Rpb24odGhpcy5fZGIudHJhbnNhY3Rpb24uYXBwbHkodGhpcy5fZGIsIGFyZ3VtZW50cykpO1xuICB9O1xuXG4gIHByb3h5UHJvcGVydGllcyhEQiwgJ19kYicsIFsnbmFtZScsICd2ZXJzaW9uJywgJ29iamVjdFN0b3JlTmFtZXMnXSk7XG4gIHByb3h5TWV0aG9kcyhEQiwgJ19kYicsIElEQkRhdGFiYXNlLCBbJ2Nsb3NlJ10pOyAvLyBBZGQgY3Vyc29yIGl0ZXJhdG9yc1xuICAvLyBUT0RPOiByZW1vdmUgdGhpcyBvbmNlIGJyb3dzZXJzIGRvIHRoZSByaWdodCB0aGluZyB3aXRoIHByb21pc2VzXG5cbiAgWydvcGVuQ3Vyc29yJywgJ29wZW5LZXlDdXJzb3InXS5mb3JFYWNoKGZ1bmN0aW9uIChmdW5jTmFtZSkge1xuICAgIFtPYmplY3RTdG9yZSwgSW5kZXhdLmZvckVhY2goZnVuY3Rpb24gKENvbnN0cnVjdG9yKSB7XG4gICAgICAvLyBEb24ndCBjcmVhdGUgaXRlcmF0ZUtleUN1cnNvciBpZiBvcGVuS2V5Q3Vyc29yIGRvZXNuJ3QgZXhpc3QuXG4gICAgICBpZiAoIShmdW5jTmFtZSBpbiBDb25zdHJ1Y3Rvci5wcm90b3R5cGUpKSByZXR1cm47XG5cbiAgICAgIENvbnN0cnVjdG9yLnByb3RvdHlwZVtmdW5jTmFtZS5yZXBsYWNlKCdvcGVuJywgJ2l0ZXJhdGUnKV0gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBhcmdzID0gdG9BcnJheShhcmd1bWVudHMpO1xuICAgICAgICB2YXIgY2FsbGJhY2sgPSBhcmdzW2FyZ3MubGVuZ3RoIC0gMV07XG4gICAgICAgIHZhciBuYXRpdmVPYmplY3QgPSB0aGlzLl9zdG9yZSB8fCB0aGlzLl9pbmRleDtcbiAgICAgICAgdmFyIHJlcXVlc3QgPSBuYXRpdmVPYmplY3RbZnVuY05hbWVdLmFwcGx5KG5hdGl2ZU9iamVjdCwgYXJncy5zbGljZSgwLCAtMSkpO1xuXG4gICAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGNhbGxiYWNrKHJlcXVlc3QucmVzdWx0KTtcbiAgICAgICAgfTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH0pOyAvLyBwb2x5ZmlsbCBnZXRBbGxcblxuICBbSW5kZXgsIE9iamVjdFN0b3JlXS5mb3JFYWNoKGZ1bmN0aW9uIChDb25zdHJ1Y3Rvcikge1xuICAgIGlmIChDb25zdHJ1Y3Rvci5wcm90b3R5cGUuZ2V0QWxsKSByZXR1cm47XG5cbiAgICBDb25zdHJ1Y3Rvci5wcm90b3R5cGUuZ2V0QWxsID0gZnVuY3Rpb24gKHF1ZXJ5LCBjb3VudCkge1xuICAgICAgdmFyIGluc3RhbmNlID0gdGhpcztcbiAgICAgIHZhciBpdGVtcyA9IFtdO1xuICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7XG4gICAgICAgIGluc3RhbmNlLml0ZXJhdGVDdXJzb3IocXVlcnksIGZ1bmN0aW9uIChjdXJzb3IpIHtcbiAgICAgICAgICBpZiAoIWN1cnNvcikge1xuICAgICAgICAgICAgcmVzb2x2ZShpdGVtcyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaXRlbXMucHVzaChjdXJzb3IudmFsdWUpO1xuXG4gICAgICAgICAgaWYgKGNvdW50ICE9PSB1bmRlZmluZWQgJiYgaXRlbXMubGVuZ3RoID09IGNvdW50KSB7XG4gICAgICAgICAgICByZXNvbHZlKGl0ZW1zKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBjdXJzb3IuY29udGludWUoKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9O1xuICB9KTtcbiAgdmFyIGV4cCA9IHtcbiAgICBvcGVuOiBmdW5jdGlvbiBvcGVuKG5hbWUsIHZlcnNpb24sIHVwZ3JhZGVDYWxsYmFjaykge1xuICAgICAgdmFyIHAgPSBwcm9taXNpZnlSZXF1ZXN0Q2FsbChpbmRleGVkREIsICdvcGVuJywgW25hbWUsIHZlcnNpb25dKTtcbiAgICAgIHZhciByZXF1ZXN0ID0gcC5yZXF1ZXN0O1xuXG4gICAgICBpZiAocmVxdWVzdCkge1xuICAgICAgICByZXF1ZXN0Lm9udXBncmFkZW5lZWRlZCA9IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgIGlmICh1cGdyYWRlQ2FsbGJhY2spIHtcbiAgICAgICAgICAgIHVwZ3JhZGVDYWxsYmFjayhuZXcgVXBncmFkZURCKHJlcXVlc3QucmVzdWx0LCBldmVudC5vbGRWZXJzaW9uLCByZXF1ZXN0LnRyYW5zYWN0aW9uKSk7XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gcC50aGVuKGZ1bmN0aW9uIChkYikge1xuICAgICAgICByZXR1cm4gbmV3IERCKGRiKTtcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgZGVsZXRlOiBmdW5jdGlvbiBfZGVsZXRlKG5hbWUpIHtcbiAgICAgIHJldHVybiBwcm9taXNpZnlSZXF1ZXN0Q2FsbChpbmRleGVkREIsICdkZWxldGVEYXRhYmFzZScsIFtuYW1lXSk7XG4gICAgfVxuICB9O1xuXG4gIGlmICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJykge1xuICAgIG1vZHVsZS5leHBvcnRzID0gZXhwO1xuICAgIG1vZHVsZS5leHBvcnRzLmRlZmF1bHQgPSBtb2R1bGUuZXhwb3J0cztcbiAgfSBlbHNlIHtcbiAgICBzZWxmLmlkYiA9IGV4cDtcbiAgfVxufSkoKTsiLCJcInVzZSBzdHJpY3RcIjtcblxuLyogU2VydmljZSBXb3JrZXIgKi9cbmlmIChuYXZpZ2F0b3Iuc2VydmljZVdvcmtlcikge1xuICBuYXZpZ2F0b3Iuc2VydmljZVdvcmtlci5yZWdpc3Rlcignc3cuanMnKS50aGVuKGZ1bmN0aW9uIChyZWcpIHtcbiAgICBjb25zb2xlLmxvZygnc2VydmljZSB3b3JrZXIgcmVnaXN0ZXJlZC4nKTtcbiAgICBjb25zb2xlLmxvZyhyZWcpO1xuICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XG4gICAgY29uc29sZS5sb2coJ3Byb2JsZW0gcmVnaXN0ZXJpbmcgc2VydmljZSB3b3JrZXInKTtcbiAgICBjb25zb2xlLmxvZyhlcnIpO1xuICB9KTtcbn0iXX0=
