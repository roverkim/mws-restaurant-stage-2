"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}var restaurants,neighborhoods,cuisines,map,DBHelper=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"idbDatabase",value:function(){return navigator.serviceWorker?idb.open("mws-restaurant",1,function(e){e.createObjectStore("restaurantDb",{keyPath:"id"}).createIndex("id","id")}):Promise.resolve}},{key:"handleErrors",value:function(t){return t.ok||e.idbDatabase().then(function(e){if(!e)throw Error(t.statusText);var n=e.transaction("restaurantDb","readwrite").objectStore("restaurantDb");if(n.getAll()<=0)throw Error(t.statusText);return n.getAll()}),t.json()}},{key:"fetchRestaurants",value:function(t){return fetch(this.DATABASE_URL).then(this.handleErrors).then(function(n){var r=n;e.idbDatabase().then(function(e){if(e){var t=e.transaction("restaurantDb","readwrite").objectStore("restaurantDb");r.forEach(function(e){t.put(e)});t.index("id").openCursor(null,"prev").then(function(e){return e.advance(30)}).then(function e(t){if(t)return t.delete(),t.continue().then(e)});return t.getAll()}}).then(function(e){return t(null,e),e})}).catch(function(e){return console.log(e)})}},{key:"fetchRestaurantById",value:function(t,n){e.fetchRestaurants(function(e,r){if(e)n(e,null);else{var o=r.find(function(e){return e.id==t});o?n(null,o):n("Restaurant does not exist",null)}})}},{key:"fetchRestaurantByCuisine",value:function(t,n){e.fetchRestaurants(function(e,r){if(e)n(e,null);else{var o=r.filter(function(e){return e.cuisine_type==t});n(null,o)}})}},{key:"fetchRestaurantByNeighborhood",value:function(t,n){e.fetchRestaurants(function(e,r){if(e)n(e,null);else{var o=r.filter(function(e){return e.neighborhood==t});n(null,o)}})}},{key:"fetchRestaurantByCuisineAndNeighborhood",value:function(t,n,r){e.fetchRestaurants(function(e,o){if(e)r(e,null);else{var a=o;"all"!=t&&(a=a.filter(function(e){return e.cuisine_type==t})),"all"!=n&&(a=a.filter(function(e){return e.neighborhood==n})),r(null,a)}})}},{key:"fetchNeighborhoods",value:function(t){e.fetchRestaurants(function(e,n){if(e)t(e,null);else{var r=n.map(function(e,t){return n[t].neighborhood}),o=r.filter(function(e,t){return r.indexOf(e)==t});t(null,o)}})}},{key:"fetchCuisines",value:function(t){e.fetchRestaurants(function(e,n){if(e)t(e,null);else{var r=n.map(function(e,t){return n[t].cuisine_type}),o=r.filter(function(e,t){return r.indexOf(e)==t});t(null,o)}})}},{key:"urlForRestaurant",value:function(e){return"./restaurant.html?id=".concat(e.id)}},{key:"imageUrlForRestaurant",value:function(e){return"/img/".concat(e.photograph,".jpg")}},{key:"mapMarkerForRestaurant",value:function(t,n){var r=new google.maps.Marker({position:t.latlng,title:t.name,url:e.urlForRestaurant(t),map:n,animation:google.maps.Animation.DROP});return r.tabindex=-1,r}},{key:"DATABASE_URL",get:function(){return"http://localhost:1337/restaurants"}}]),e}();function lazyLoader(){console.log("executing lazy loading");var e=[].slice.call(document.querySelectorAll("img.lazy")),t=!1,n=function n(){!1===t&&(t=!0,setTimeout(function(){e.forEach(function(t){t.getBoundingClientRect().top<=window.innerHeight&&t.getBoundingClientRect().bottom>=0&&"none"!==getComputedStyle(t).display&&(t.src=t.getAttribute("data-src"),t.classList.remove("lazy"),0===(e=e.filter(function(e){return e!==t})).length&&(document.removeEventListener("scroll",n),window.removeEventListener("resize",n),window.removeEventListener("orientationchange",n)))}),t=!1},200))};document.addEventListener("scroll",n),window.addEventListener("resize",n),window.addEventListener("orientationchange",n)}!function(){function e(e){return new Promise(function(t,n){e.onsuccess=function(){t(e.result)},e.onerror=function(){n(e.error)}})}function t(t,n,r){var o,a=new Promise(function(a,i){e(o=t[n].apply(t,r)).then(a,i)});return a.request=o,a}function n(e,t,n){n.forEach(function(n){Object.defineProperty(e.prototype,n,{get:function(){return this[t][n]},set:function(e){this[t][n]=e}})})}function r(e,n,r,o){o.forEach(function(o){o in r.prototype&&(e.prototype[o]=function(){return t(this[n],o,arguments)})})}function o(e,t,n,r){r.forEach(function(r){r in n.prototype&&(e.prototype[r]=function(){return this[t][r].apply(this[t],arguments)})})}function a(e,n,r,o){o.forEach(function(o){o in r.prototype&&(e.prototype[o]=function(){return e=this[n],(r=t(e,o,arguments)).then(function(e){if(e)return new u(e,r.request)});var e,r})})}function i(e){this._index=e}function u(e,t){this._cursor=e,this._request=t}function s(e){this._store=e}function c(e){this._tx=e,this.complete=new Promise(function(t,n){e.oncomplete=function(){t()},e.onerror=function(){n(e.error)},e.onabort=function(){n(e.error)}})}function l(e,t,n){this._db=e,this.oldVersion=t,this.transaction=new c(n)}function f(e){this._db=e}n(i,"_index",["name","keyPath","multiEntry","unique"]),r(i,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),a(i,"_index",IDBIndex,["openCursor","openKeyCursor"]),n(u,"_cursor",["direction","key","primaryKey","value"]),r(u,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(t){t in IDBCursor.prototype&&(u.prototype[t]=function(){var n=this,r=arguments;return Promise.resolve().then(function(){return n._cursor[t].apply(n._cursor,r),e(n._request).then(function(e){if(e)return new u(e,n._request)})})})}),s.prototype.createIndex=function(){return new i(this._store.createIndex.apply(this._store,arguments))},s.prototype.index=function(){return new i(this._store.index.apply(this._store,arguments))},n(s,"_store",["name","keyPath","indexNames","autoIncrement"]),r(s,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),a(s,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),o(s,"_store",IDBObjectStore,["deleteIndex"]),c.prototype.objectStore=function(){return new s(this._tx.objectStore.apply(this._tx,arguments))},n(c,"_tx",["objectStoreNames","mode"]),o(c,"_tx",IDBTransaction,["abort"]),l.prototype.createObjectStore=function(){return new s(this._db.createObjectStore.apply(this._db,arguments))},n(l,"_db",["name","version","objectStoreNames"]),o(l,"_db",IDBDatabase,["deleteObjectStore","close"]),f.prototype.transaction=function(){return new c(this._db.transaction.apply(this._db,arguments))},n(f,"_db",["name","version","objectStoreNames"]),o(f,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(e){[s,i].forEach(function(t){e in t.prototype&&(t.prototype[e.replace("open","iterate")]=function(){var t,n=(t=arguments,Array.prototype.slice.call(t)),r=n[n.length-1],o=this._store||this._index,a=o[e].apply(o,n.slice(0,-1));a.onsuccess=function(){r(a.result)}})})}),[i,s].forEach(function(e){e.prototype.getAll||(e.prototype.getAll=function(e,t){var n=this,r=[];return new Promise(function(o){n.iterateCursor(e,function(e){e?(r.push(e.value),void 0===t||r.length!=t?e.continue():o(r)):o(r)})})})});var d={open:function(e,n,r){var o=t(indexedDB,"open",[e,n]),a=o.request;return a&&(a.onupgradeneeded=function(e){r&&r(new l(a.result,e.oldVersion,a.transaction))}),o.then(function(e){return new f(e)})},delete:function(e){return t(indexedDB,"deleteDatabase",[e])}};"undefined"!=typeof module?(module.exports=d,module.exports.default=module.exports):self.idb=d}();var markers=[];document.addEventListener("DOMContentLoaded",function(e){fetchNeighborhoods(),fetchCuisines()});var fetchNeighborhoods=function(){DBHelper.fetchNeighborhoods(function(e,t){e?console.error(e):(self.neighborhoods=t,fillNeighborhoodsHTML())})},fillNeighborhoodsHTML=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:self.neighborhoods,t=document.getElementById("neighborhoods-select");e.forEach(function(e){var n=document.createElement("option");n.innerHTML=e,n.value=e,n.className+="radio",t.append(n)})},fetchCuisines=function(){DBHelper.fetchCuisines(function(e,t){e?console.error(e):(self.cuisines=t,fillCuisinesHTML())})},fillCuisinesHTML=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:self.cuisines,t=document.getElementById("cuisines-select");e.forEach(function(e){var n=document.createElement("option");n.innerHTML=e,n.value=e,t.append(n)})};window.initMap=function(){self.map=new google.maps.Map(document.getElementById("map"),{zoom:12,center:{lat:40.722216,lng:-73.987501},scrollwheel:!1}),updateRestaurants()};var updateRestaurants=function(){var e=document.getElementById("cuisines-select"),t=document.getElementById("neighborhoods-select"),n=e.selectedIndex,r=t.selectedIndex,o=e[n].value,a=t[r].value;DBHelper.fetchRestaurantByCuisineAndNeighborhood(o,a,function(e,t){e?console.error(e):(resetRestaurants(t),fillRestaurantsHTML(),document.querySelector("#restaurants-list").setAttribute("aria-label","List of Restaurants ".concat(a?"all"==a?"":"Filtered by ".concat(a):""," ").concat(o?"all"==o?"":"and ".concat(o):"")))})},resetRestaurants=function(e){self.restaurants=[],document.getElementById("restaurants-list").innerHTML="",self.markers.forEach(function(e){return e.setMap(null)}),self.markers=[],self.restaurants=e},fillRestaurantsHTML=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:self.restaurants,t=document.getElementById("restaurants-list");e.forEach(function(e){t.append(createRestaurantHTML(e))}),addMarkersToMap(),lazyLoader()},createRestaurantHTML=function(e){var t=document.createElement("li"),n=document.createElement("img");n.className="restaurant-img lazy",n.setAttribute("data-src",DBHelper.imageUrlForRestaurant(e)),n.setAttribute("src"," "),n.alt=e.name+"restaurant",t.append(n);var r=document.createElement("h2");r.innerHTML=e.name,r.setAttribute("aria-label","restaurant name: ".concat(e.name)),t.append(r);var o=document.createElement("p");o.innerHTML=e.neighborhood,o.setAttribute("aria-label","neighborhood: ".concat(e.neighborhood)),t.append(o);var a=document.createElement("p");a.innerHTML=e.address,a.setAttribute("aria-label","restaurant address: ".concat(e.address)),t.append(a);var i=document.createElement("a");return i.innerHTML="View Details",i.href=DBHelper.urlForRestaurant(e),i.setAttribute("role","button"),i.setAttribute("tabindex","0"),i.setAttribute("aria-label","Click to navigate to ".concat(e.name," review page. restaurant address: ").concat(e.address," ").concat(e.neighborhood,". ")),t.append(i),t},addMarkersToMap=function(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:self.restaurants).forEach(function(e){var t=DBHelper.mapMarkerForRestaurant(e,self.map);google.maps.event.addListener(t,"click",function(){window.location.href=t.url}),self.markers.push(t)})};navigator.serviceWorker&&navigator.serviceWorker.register("sw.js").then(function(e){console.log("service worker registered."),console.log(e)}).catch(function(e){console.log("problem registering service worker"),console.log(e)});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRiaGVscGVyLmpzIiwibWFpbi5qcyIsImxhenlsb2FkZXIuanMiLCJpZGIuanMiLCJyZWdpc3RlcnN3LmpzIl0sIm5hbWVzIjpbIl9jbGFzc0NhbGxDaGVjayIsImluc3RhbmNlIiwiQ29uc3RydWN0b3IiLCJUeXBlRXJyb3IiLCJfZGVmaW5lUHJvcGVydGllcyIsInRhcmdldCIsInByb3BzIiwiaSIsImxlbmd0aCIsImRlc2NyaXB0b3IiLCJlbnVtZXJhYmxlIiwiY29uZmlndXJhYmxlIiwid3JpdGFibGUiLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImtleSIsIl9jcmVhdGVDbGFzcyIsInByb3RvUHJvcHMiLCJzdGF0aWNQcm9wcyIsInByb3RvdHlwZSIsInJlc3RhdXJhbnRzIiwibmVpZ2hib3Job29kcyIsImN1aXNpbmVzIiwibWFwIiwiREJIZWxwZXIiLCJ0aGlzIiwidmFsdWUiLCJuYXZpZ2F0b3IiLCJzZXJ2aWNlV29ya2VyIiwiaWRiIiwib3BlbiIsInVwZ3JhZGVEQiIsImNyZWF0ZU9iamVjdFN0b3JlIiwia2V5UGF0aCIsImNyZWF0ZUluZGV4IiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZXNwb25zZSIsIm9rIiwiaWRiRGF0YWJhc2UiLCJ0aGVuIiwiZGIiLCJFcnJvciIsInN0YXR1c1RleHQiLCJzdG9yZSIsInRyYW5zYWN0aW9uIiwib2JqZWN0U3RvcmUiLCJnZXRBbGwiLCJqc29uIiwiY2FsbGJhY2siLCJmZXRjaCIsIkRBVEFCQVNFX1VSTCIsImhhbmRsZUVycm9ycyIsInJlcyIsImZvckVhY2giLCJyZXN0YXVyYW50IiwicHV0IiwiaW5kZXgiLCJvcGVuQ3Vyc29yIiwiY3Vyc29yIiwiYWR2YW5jZSIsImRlbGV0ZVJlc3QiLCJkZWxldGUiLCJjb250aW51ZSIsImNhdGNoIiwiZXJyIiwiY29uc29sZSIsImxvZyIsImlkIiwiZmV0Y2hSZXN0YXVyYW50cyIsImVycm9yIiwiZmluZCIsInIiLCJjdWlzaW5lIiwicmVzdWx0cyIsImZpbHRlciIsImN1aXNpbmVfdHlwZSIsIm5laWdoYm9yaG9vZCIsInYiLCJ1bmlxdWVOZWlnaGJvcmhvb2RzIiwiaW5kZXhPZiIsInVuaXF1ZUN1aXNpbmVzIiwiY29uY2F0IiwicGhvdG9ncmFwaCIsIm1hcmtlciIsImdvb2dsZSIsIm1hcHMiLCJNYXJrZXIiLCJwb3NpdGlvbiIsImxhdGxuZyIsInRpdGxlIiwibmFtZSIsInVybCIsInVybEZvclJlc3RhdXJhbnQiLCJhbmltYXRpb24iLCJBbmltYXRpb24iLCJEUk9QIiwidGFiaW5kZXgiLCJnZXQiLCJsYXp5TG9hZGVyIiwibGF6eUltYWdlcyIsInNsaWNlIiwiY2FsbCIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvckFsbCIsImFjdGl2ZSIsImxhenlMb2FkIiwic2V0VGltZW91dCIsImxhenlJbWFnZSIsImdldEJvdW5kaW5nQ2xpZW50UmVjdCIsInRvcCIsIndpbmRvdyIsImlubmVySGVpZ2h0IiwiYm90dG9tIiwiZ2V0Q29tcHV0ZWRTdHlsZSIsImRpc3BsYXkiLCJzcmMiLCJnZXRBdHRyaWJ1dGUiLCJjbGFzc0xpc3QiLCJyZW1vdmUiLCJpbWFnZSIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJhZGRFdmVudExpc3RlbmVyIiwicHJvbWlzaWZ5UmVxdWVzdCIsInJlcXVlc3QiLCJyZWplY3QiLCJvbnN1Y2Nlc3MiLCJyZXN1bHQiLCJvbmVycm9yIiwicHJvbWlzaWZ5UmVxdWVzdENhbGwiLCJvYmoiLCJtZXRob2QiLCJhcmdzIiwicCIsImFwcGx5IiwicHJveHlQcm9wZXJ0aWVzIiwiUHJveHlDbGFzcyIsInRhcmdldFByb3AiLCJwcm9wZXJ0aWVzIiwicHJvcCIsInNldCIsInZhbCIsInByb3h5UmVxdWVzdE1ldGhvZHMiLCJhcmd1bWVudHMiLCJwcm94eU1ldGhvZHMiLCJwcm94eUN1cnNvclJlcXVlc3RNZXRob2RzIiwiQ3Vyc29yIiwiSW5kZXgiLCJfaW5kZXgiLCJfY3Vyc29yIiwiX3JlcXVlc3QiLCJPYmplY3RTdG9yZSIsIl9zdG9yZSIsIlRyYW5zYWN0aW9uIiwiaWRiVHJhbnNhY3Rpb24iLCJfdHgiLCJjb21wbGV0ZSIsIm9uY29tcGxldGUiLCJvbmFib3J0IiwiVXBncmFkZURCIiwib2xkVmVyc2lvbiIsIl9kYiIsIkRCIiwiSURCSW5kZXgiLCJJREJDdXJzb3IiLCJtZXRob2ROYW1lIiwiSURCT2JqZWN0U3RvcmUiLCJJREJUcmFuc2FjdGlvbiIsIklEQkRhdGFiYXNlIiwiZnVuY05hbWUiLCJyZXBsYWNlIiwiYXJyIiwiQXJyYXkiLCJuYXRpdmVPYmplY3QiLCJxdWVyeSIsImNvdW50IiwiaXRlbXMiLCJpdGVyYXRlQ3Vyc29yIiwicHVzaCIsInVuZGVmaW5lZCIsImV4cCIsInZlcnNpb24iLCJ1cGdyYWRlQ2FsbGJhY2siLCJpbmRleGVkREIiLCJvbnVwZ3JhZGVuZWVkZWQiLCJldmVudCIsIm1vZHVsZSIsImV4cG9ydHMiLCJkZWZhdWx0Iiwic2VsZiIsIm1hcmtlcnMiLCJmZXRjaE5laWdoYm9yaG9vZHMiLCJmZXRjaEN1aXNpbmVzIiwiZmlsbE5laWdoYm9yaG9vZHNIVE1MIiwic2VsZWN0IiwiZ2V0RWxlbWVudEJ5SWQiLCJvcHRpb24iLCJjcmVhdGVFbGVtZW50IiwiaW5uZXJIVE1MIiwiY2xhc3NOYW1lIiwiYXBwZW5kIiwiZmlsbEN1aXNpbmVzSFRNTCIsImluaXRNYXAiLCJNYXAiLCJ6b29tIiwiY2VudGVyIiwibGF0IiwibG5nIiwic2Nyb2xsd2hlZWwiLCJ1cGRhdGVSZXN0YXVyYW50cyIsImNTZWxlY3QiLCJuU2VsZWN0IiwiY0luZGV4Iiwic2VsZWN0ZWRJbmRleCIsIm5JbmRleCIsImZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZUFuZE5laWdoYm9yaG9vZCIsInJlc2V0UmVzdGF1cmFudHMiLCJmaWxsUmVzdGF1cmFudHNIVE1MIiwicXVlcnlTZWxlY3RvciIsInNldEF0dHJpYnV0ZSIsIm0iLCJzZXRNYXAiLCJ1bCIsImNyZWF0ZVJlc3RhdXJhbnRIVE1MIiwiYWRkTWFya2Vyc1RvTWFwIiwibGkiLCJpbWFnZVVybEZvclJlc3RhdXJhbnQiLCJhbHQiLCJhZGRyZXNzIiwibW9yZSIsImhyZWYiLCJtYXBNYXJrZXJGb3JSZXN0YXVyYW50IiwiYWRkTGlzdGVuZXIiLCJsb2NhdGlvbiIsInJlZ2lzdGVyIiwicmVnIl0sIm1hcHBpbmdzIjoiQUFBQSxhQUVBLFNBQUFBLGdCQUFBQyxFQUFBQyxHQUFBLEtBQUFELGFBQUFDLEdBQUEsTUFBQSxJQUFBQyxVQUFBLHFDQUVBLFNBQUFDLGtCQUFBQyxFQUFBQyxHQUFBLElBQUEsSUFBQUMsRUFBQSxFQUFBQSxFQUFBRCxFQUFBRSxPQUFBRCxJQUFBLENBQUEsSUFBQUUsRUFBQUgsRUFBQUMsR0FBQUUsRUFBQUMsV0FBQUQsRUFBQUMsYUFBQSxFQUFBRCxFQUFBRSxjQUFBLEVBQUEsVUFBQUYsSUFBQUEsRUFBQUcsVUFBQSxHQUFBQyxPQUFBQyxlQUFBVCxFQUFBSSxFQUFBTSxJQUFBTixJQUVBLFNBQUFPLGFBQUFkLEVBQUFlLEVBQUFDLEdBQUEsT0FBQUQsR0FBQWIsa0JBQUFGLEVBQUFpQixVQUFBRixHQUFBQyxHQUFBZCxrQkFBQUYsRUFBQWdCLEdBQUFoQixFQUtBLElDVEFrQixZQUFBQyxjQUFBQyxTQUNBQyxJRFFBQyxTQUVBLFdBQ0EsU0FBQUEsSUFDQXhCLGdCQUFBeUIsS0FBQUQsR0E0UUEsT0F6UUFSLGFBQUFRLEVBQUEsS0FBQSxDQUFBLENBQ0FULElBQUEsY0FDQVcsTUFBQSxXQUNBLE9BQUFDLFVBQUFDLGNBSUFDLElBQUFDLEtBQUEsaUJBQUEsRUFBQSxTQUFBQyxHQUNBQSxFQUFBQyxrQkFBQSxlQUFBLENBQ0FDLFFBQUEsT0FFQUMsWUFBQSxLQUFBLFFBUEFDLFFBQUFDLFVBVUEsQ0FDQXJCLElBQUEsZUFLQVcsTUFBQSxTQUFBVyxHQWlCQSxPQWZBQSxFQUFBQyxJQUVBZCxFQUFBZSxjQUFBQyxLQUFBLFNBQUFDLEdBQ0EsSUFBQUEsRUFBQSxNQUFBQyxNQUFBTCxFQUFBTSxZQUNBLElBQ0FDLEVBREFILEVBQUFJLFlBQUEsZUFBQSxhQUNBQyxZQUFB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LEtBQ0ErQixFQUFBOUIsVUFBQS9JLEVBQUE2SyxRQUNBQSxFQUFBVCxhQUFBLGFBQUEsdUJBQUF6SSxPQUFBM0IsRUFBQTZLLFVBQ0FILEVBQUF6QixPQUFBNEIsR0FDQSxJQUFBQyxFQUFBOUgsU0FBQThGLGNBQUEsS0FPQSxPQU5BZ0MsRUFBQS9CLFVBQUEsZUFDQStCLEVBQUFDLEtBQUE5TSxTQUFBcUUsaUJBQUF0QyxHQUNBOEssRUFBQVYsYUFBQSxPQUFBLFVBQ0FVLEVBQUFWLGFBQUEsV0FBQSxLQUNBVSxFQUFBVixhQUFBLGFBQUEsd0JBQUF6SSxPQUFBM0IsRUFBQW9DLEtBQUEsc0NBQUFULE9BQUEzQixFQUFBNkssUUFBQSxLQUFBbEosT0FBQTNCLEVBQUFzQixhQUFBLE9BQ0FvSixFQUFBekIsT0FBQTZCLEdBQ0FKLEdBT0FELGdCQUFBLFlBQ0FqRixVQUFBdkksT0FBQSxRQUFBMkssSUFBQXBDLFVBQUEsR0FBQUEsVUFBQSxHQUFBOEMsS0FBQXpLLGFBQ0FrQyxRQUFBLFNBQUFDLEdBRUEsSUFBQTZCLEVBQUE1RCxTQUFBK00sdUJBQUFoTCxFQUFBc0ksS0FBQXRLLEtBQ0E4RCxPQUFBQyxLQUFBbUcsTUFBQStDLFlBQUFwSixFQUFBLFFBQUEsV0FDQTJCLE9BQUEwSCxTQUFBSCxLQUFBbEosRUFBQVEsTUFFQWlHLEtBQUFDLFFBQUFaLEtBQUE5RixNRy9MQXpELFVBQUFDLGVBQ0FELFVBQUFDLGNBQUE4TSxTQUFBLFNBQUFsTSxLQUFBLFNBQUFtTSxHQUNBekssUUFBQUMsSUFBQSw4QkFDQUQsUUFBQUMsSUFBQXdLLEtBQ0EzSyxNQUFBLFNBQUFDLEdBQ0FDLFFBQUFDLElBQUEsc0NBQ0FELFFBQUFDLElBQUFGIiwiZmlsZSI6ImluZGV4SnMuanMiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxuZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uXCIpOyB9IH1cblxuZnVuY3Rpb24gX2RlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoXCJ2YWx1ZVwiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfVxuXG5mdW5jdGlvbiBfY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfVxuXG4vKipcclxuICogQ29tbW9uIGRhdGFiYXNlIGhlbHBlciBmdW5jdGlvbnMuXHJcbiAqL1xudmFyIERCSGVscGVyID1cbi8qI19fUFVSRV9fKi9cbmZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gREJIZWxwZXIoKSB7XG4gICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIERCSGVscGVyKTtcbiAgfVxuXG4gIF9jcmVhdGVDbGFzcyhEQkhlbHBlciwgbnVsbCwgW3tcbiAgICBrZXk6IFwiaWRiRGF0YWJhc2VcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gaWRiRGF0YWJhc2UoKSB7XG4gICAgICBpZiAoIW5hdmlnYXRvci5zZXJ2aWNlV29ya2VyKSB7XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmU7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBpZGIub3BlbignbXdzLXJlc3RhdXJhbnQnLCAxLCBmdW5jdGlvbiAodXBncmFkZURCKSB7XG4gICAgICAgIHZhciByZXN0YXVyYW50RGIgPSB1cGdyYWRlREIuY3JlYXRlT2JqZWN0U3RvcmUoJ3Jlc3RhdXJhbnREYicsIHtcbiAgICAgICAgICBrZXlQYXRoOiAnaWQnXG4gICAgICAgIH0pO1xuICAgICAgICByZXN0YXVyYW50RGIuY3JlYXRlSW5kZXgoJ2lkJywgJ2lkJyk7XG4gICAgICB9KTtcbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6IFwiaGFuZGxlRXJyb3JzXCIsXG5cbiAgICAvKipcclxuICAgICAqIEZldGNoIGFsbCByZXN0YXVyYW50cy5cclxuICAgICAqL1xuICAgIHZhbHVlOiBmdW5jdGlvbiBoYW5kbGVFcnJvcnMocmVzcG9uc2UpIHtcbiAgICAgIC8vIElmIE5ldHdvcmsgZmFpbGVkXG4gICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICAgIC8vIE9wZW4gRGF0YWJhc2UgYW5kIGdldCB1cmwgcmVmZXJlbmNlIGZyb20gaWRiXG4gICAgICAgIERCSGVscGVyLmlkYkRhdGFiYXNlKCkudGhlbihmdW5jdGlvbiAoZGIpIHtcbiAgICAgICAgICBpZiAoIWRiKSB0aHJvdyBFcnJvcihyZXNwb25zZS5zdGF0dXNUZXh0KTtcbiAgICAgICAgICB2YXIgdHggPSBkYi50cmFuc2FjdGlvbigncmVzdGF1cmFudERiJywgJ3JlYWR3cml0ZScpO1xuICAgICAgICAgIHZhciBzdG9yZSA9IHR4Lm9iamVjdFN0b3JlKCdyZXN0YXVyYW50RGInKTtcblxuICAgICAgICAgIGlmIChzdG9yZS5nZXRBbGwoKSA8PSAwKSB7XG4gICAgICAgICAgICB0aHJvdyBFcnJvcihyZXNwb25zZS5zdGF0dXNUZXh0KTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICByZXR1cm4gc3RvcmUuZ2V0QWxsKCk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpO1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogXCJmZXRjaFJlc3RhdXJhbnRzXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGZldGNoUmVzdGF1cmFudHMoY2FsbGJhY2spIHtcbiAgICAgIHJldHVybiBmZXRjaCh0aGlzLkRBVEFCQVNFX1VSTCkudGhlbih0aGlzLmhhbmRsZUVycm9ycykudGhlbihmdW5jdGlvbiAocmVzKSB7XG4gICAgICAgIHZhciByZXN0YXVyYW50cyA9IHJlczsgLy8gU3RvcmUgRmV0Y2hlZCBSZXF1ZXN0IGluIGlkYlxuXG4gICAgICAgIERCSGVscGVyLmlkYkRhdGFiYXNlKCkudGhlbihmdW5jdGlvbiAoZGIpIHtcbiAgICAgICAgICBpZiAoIWRiKSByZXR1cm47XG4gICAgICAgICAgdmFyIHR4ID0gZGIudHJhbnNhY3Rpb24oJ3Jlc3RhdXJhbnREYicsICdyZWFkd3JpdGUnKTtcbiAgICAgICAgICB2YXIgc3RvcmUgPSB0eC5vYmplY3RTdG9yZSgncmVzdGF1cmFudERiJyk7XG4gICAgICAgICAgcmVzdGF1cmFudHMuZm9yRWFjaChmdW5jdGlvbiAocmVzdGF1cmFudCkge1xuICAgICAgICAgICAgc3RvcmUucHV0KHJlc3RhdXJhbnQpO1xuICAgICAgICAgIH0pOyAvLyBsaW1pdCBzdG9yZSB0byAzMCBpdGVtc1xuXG4gICAgICAgICAgdmFyIGRhdGEgPSBzdG9yZS5pbmRleCgnaWQnKS5vcGVuQ3Vyc29yKG51bGwsIFwicHJldlwiKS50aGVuKGZ1bmN0aW9uIChjdXJzb3IpIHtcbiAgICAgICAgICAgIHJldHVybiBjdXJzb3IuYWR2YW5jZSgzMCk7XG4gICAgICAgICAgfSkudGhlbihmdW5jdGlvbiBkZWxldGVSZXN0KGN1cnNvcikge1xuICAgICAgICAgICAgaWYgKCFjdXJzb3IpIHJldHVybjtcbiAgICAgICAgICAgIGN1cnNvci5kZWxldGUoKTtcbiAgICAgICAgICAgIHJldHVybiBjdXJzb3IuY29udGludWUoKS50aGVuKGRlbGV0ZVJlc3QpO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIHJldHVybiBzdG9yZS5nZXRBbGwoKTsgLy8gUmV0dXJuIFN0b3JlZCBEYXRhXG4gICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3RhdXJhbnRzKSB7XG4gICAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdGF1cmFudHMpO1xuICAgICAgICAgIHJldHVybiByZXN0YXVyYW50cztcbiAgICAgICAgfSk7XG4gICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgIHJldHVybiBjb25zb2xlLmxvZyhlcnIpO1xuICAgICAgfSk7XG4gICAgfVxuICAgIC8qKlxyXG4gICAgICogRmV0Y2ggYSByZXN0YXVyYW50IGJ5IGl0cyBJRC5cclxuICAgICAqL1xuXG4gIH0sIHtcbiAgICBrZXk6IFwiZmV0Y2hSZXN0YXVyYW50QnlJZFwiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBmZXRjaFJlc3RhdXJhbnRCeUlkKGlkLCBjYWxsYmFjaykge1xuICAgICAgLy8gZmV0Y2ggYWxsIHJlc3RhdXJhbnRzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxuICAgICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cyhmdW5jdGlvbiAoZXJyb3IsIHJlc3RhdXJhbnRzKSB7XG4gICAgICAgIGlmIChlcnJvcikge1xuICAgICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB2YXIgcmVzdGF1cmFudCA9IHJlc3RhdXJhbnRzLmZpbmQoZnVuY3Rpb24gKHIpIHtcbiAgICAgICAgICAgIHJldHVybiByLmlkID09IGlkO1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgaWYgKHJlc3RhdXJhbnQpIHtcbiAgICAgICAgICAgIC8vIEdvdCB0aGUgcmVzdGF1cmFudFxuICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdGF1cmFudCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIFJlc3RhdXJhbnQgZG9lcyBub3QgZXhpc3QgaW4gdGhlIGRhdGFiYXNlXG4gICAgICAgICAgICBjYWxsYmFjaygnUmVzdGF1cmFudCBkb2VzIG5vdCBleGlzdCcsIG51bGwpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICAgIC8qKlxyXG4gICAgICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBjdWlzaW5lIHR5cGUgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICAgKi9cblxuICB9LCB7XG4gICAga2V5OiBcImZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZVwiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmUoY3Vpc2luZSwgY2FsbGJhY2spIHtcbiAgICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50cyAgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmdcbiAgICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoZnVuY3Rpb24gKGVycm9yLCByZXN0YXVyYW50cykge1xuICAgICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gRmlsdGVyIHJlc3RhdXJhbnRzIHRvIGhhdmUgb25seSBnaXZlbiBjdWlzaW5lIHR5cGVcbiAgICAgICAgICB2YXIgcmVzdWx0cyA9IHJlc3RhdXJhbnRzLmZpbHRlcihmdW5jdGlvbiAocikge1xuICAgICAgICAgICAgcmV0dXJuIHIuY3Vpc2luZV90eXBlID09IGN1aXNpbmU7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0cyk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgICAvKipcclxuICAgICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgbmVpZ2hib3Job29kIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAgICovXG5cbiAgfSwge1xuICAgIGtleTogXCJmZXRjaFJlc3RhdXJhbnRCeU5laWdoYm9yaG9vZFwiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBmZXRjaFJlc3RhdXJhbnRCeU5laWdoYm9yaG9vZChuZWlnaGJvcmhvb2QsIGNhbGxiYWNrKSB7XG4gICAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcbiAgICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoZnVuY3Rpb24gKGVycm9yLCByZXN0YXVyYW50cykge1xuICAgICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gRmlsdGVyIHJlc3RhdXJhbnRzIHRvIGhhdmUgb25seSBnaXZlbiBuZWlnaGJvcmhvb2RcbiAgICAgICAgICB2YXIgcmVzdWx0cyA9IHJlc3RhdXJhbnRzLmZpbHRlcihmdW5jdGlvbiAocikge1xuICAgICAgICAgICAgcmV0dXJuIHIubmVpZ2hib3Job29kID09IG5laWdoYm9yaG9vZDtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBjYWxsYmFjayhudWxsLCByZXN1bHRzKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICAgIC8qKlxyXG4gICAgICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBjdWlzaW5lIGFuZCBhIG5laWdoYm9yaG9vZCB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgICAqL1xuXG4gIH0sIHtcbiAgICBrZXk6IFwiZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lQW5kTmVpZ2hib3Job29kXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZUFuZE5laWdoYm9yaG9vZChjdWlzaW5lLCBuZWlnaGJvcmhvb2QsIGNhbGxiYWNrKSB7XG4gICAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcbiAgICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoZnVuY3Rpb24gKGVycm9yLCByZXN0YXVyYW50cykge1xuICAgICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdmFyIHJlc3VsdHMgPSByZXN0YXVyYW50cztcblxuICAgICAgICAgIGlmIChjdWlzaW5lICE9ICdhbGwnKSB7XG4gICAgICAgICAgICAvLyBmaWx0ZXIgYnkgY3Vpc2luZVxuICAgICAgICAgICAgcmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKGZ1bmN0aW9uIChyKSB7XG4gICAgICAgICAgICAgIHJldHVybiByLmN1aXNpbmVfdHlwZSA9PSBjdWlzaW5lO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYgKG5laWdoYm9yaG9vZCAhPSAnYWxsJykge1xuICAgICAgICAgICAgLy8gZmlsdGVyIGJ5IG5laWdoYm9yaG9vZFxuICAgICAgICAgICAgcmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKGZ1bmN0aW9uIChyKSB7XG4gICAgICAgICAgICAgIHJldHVybiByLm5laWdoYm9yaG9vZCA9PSBuZWlnaGJvcmhvb2Q7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBjYWxsYmFjayhudWxsLCByZXN1bHRzKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICAgIC8qKlxyXG4gICAgICogRmV0Y2ggYWxsIG5laWdoYm9yaG9vZHMgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICAgKi9cblxuICB9LCB7XG4gICAga2V5OiBcImZldGNoTmVpZ2hib3Job29kc1wiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBmZXRjaE5laWdoYm9yaG9vZHMoY2FsbGJhY2spIHtcbiAgICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xuICAgICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cyhmdW5jdGlvbiAoZXJyb3IsIHJlc3RhdXJhbnRzKSB7XG4gICAgICAgIGlmIChlcnJvcikge1xuICAgICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBHZXQgYWxsIG5laWdoYm9yaG9vZHMgZnJvbSBhbGwgcmVzdGF1cmFudHNcbiAgICAgICAgICB2YXIgbmVpZ2hib3Job29kcyA9IHJlc3RhdXJhbnRzLm1hcChmdW5jdGlvbiAodiwgaSkge1xuICAgICAgICAgICAgcmV0dXJuIHJlc3RhdXJhbnRzW2ldLm5laWdoYm9yaG9vZDtcbiAgICAgICAgICB9KTsgLy8gUmVtb3ZlIGR1cGxpY2F0ZXMgZnJvbSBuZWlnaGJvcmhvb2RzXG5cbiAgICAgICAgICB2YXIgdW5pcXVlTmVpZ2hib3Job29kcyA9IG5laWdoYm9yaG9vZHMuZmlsdGVyKGZ1bmN0aW9uICh2LCBpKSB7XG4gICAgICAgICAgICByZXR1cm4gbmVpZ2hib3Job29kcy5pbmRleE9mKHYpID09IGk7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgY2FsbGJhY2sobnVsbCwgdW5pcXVlTmVpZ2hib3Job29kcyk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgICAvKipcclxuICAgICAqIEZldGNoIGFsbCBjdWlzaW5lcyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgICAqL1xuXG4gIH0sIHtcbiAgICBrZXk6IFwiZmV0Y2hDdWlzaW5lc1wiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBmZXRjaEN1aXNpbmVzKGNhbGxiYWNrKSB7XG4gICAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcbiAgICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoZnVuY3Rpb24gKGVycm9yLCByZXN0YXVyYW50cykge1xuICAgICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gR2V0IGFsbCBjdWlzaW5lcyBmcm9tIGFsbCByZXN0YXVyYW50c1xuICAgICAgICAgIHZhciBjdWlzaW5lcyA9IHJlc3RhdXJhbnRzLm1hcChmdW5jdGlvbiAodiwgaSkge1xuICAgICAgICAgICAgcmV0dXJuIHJlc3RhdXJhbnRzW2ldLmN1aXNpbmVfdHlwZTtcbiAgICAgICAgICB9KTsgLy8gUmVtb3ZlIGR1cGxpY2F0ZXMgZnJvbSBjdWlzaW5lc1xuXG4gICAgICAgICAgdmFyIHVuaXF1ZUN1aXNpbmVzID0gY3Vpc2luZXMuZmlsdGVyKGZ1bmN0aW9uICh2LCBpKSB7XG4gICAgICAgICAgICByZXR1cm4gY3Vpc2luZXMuaW5kZXhPZih2KSA9PSBpO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIGNhbGxiYWNrKG51bGwsIHVuaXF1ZUN1aXNpbmVzKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICAgIC8qKlxyXG4gICAgICogUmVzdGF1cmFudCBwYWdlIFVSTC5cclxuICAgICAqL1xuXG4gIH0sIHtcbiAgICBrZXk6IFwidXJsRm9yUmVzdGF1cmFudFwiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiB1cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpIHtcbiAgICAgIHJldHVybiBcIi4vcmVzdGF1cmFudC5odG1sP2lkPVwiLmNvbmNhdChyZXN0YXVyYW50LmlkKTtcbiAgICB9XG4gICAgLyoqXHJcbiAgICAgKiBSZXN0YXVyYW50IGltYWdlIFVSTC5cclxuICAgICAqL1xuXG4gIH0sIHtcbiAgICBrZXk6IFwiaW1hZ2VVcmxGb3JSZXN0YXVyYW50XCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSB7XG4gICAgICByZXR1cm4gXCIvaW1nL1wiLmNvbmNhdChyZXN0YXVyYW50LnBob3RvZ3JhcGgsIFwiLmpwZ1wiKTtcbiAgICB9XG4gICAgLyoqXHJcbiAgICAgKiBNYXAgbWFya2VyIGZvciBhIHJlc3RhdXJhbnQuXHJcbiAgICAgKi9cblxuICB9LCB7XG4gICAga2V5OiBcIm1hcE1hcmtlckZvclJlc3RhdXJhbnRcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gbWFwTWFya2VyRm9yUmVzdGF1cmFudChyZXN0YXVyYW50LCBtYXApIHtcbiAgICAgIHZhciBtYXJrZXIgPSBuZXcgZ29vZ2xlLm1hcHMuTWFya2VyKHtcbiAgICAgICAgcG9zaXRpb246IHJlc3RhdXJhbnQubGF0bG5nLFxuICAgICAgICB0aXRsZTogcmVzdGF1cmFudC5uYW1lLFxuICAgICAgICB1cmw6IERCSGVscGVyLnVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCksXG4gICAgICAgIG1hcDogbWFwLFxuICAgICAgICBhbmltYXRpb246IGdvb2dsZS5tYXBzLkFuaW1hdGlvbi5EUk9QXG4gICAgICB9KTtcbiAgICAgIG1hcmtlci50YWJpbmRleCA9IC0xO1xuICAgICAgcmV0dXJuIG1hcmtlcjtcbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6IFwiREFUQUJBU0VfVVJMXCIsXG5cbiAgICAvKipcclxuICAgICAqIERhdGFiYXNlIFVSTC5cclxuICAgICAqIENoYW5nZSB0aGlzIHRvIHJlc3RhdXJhbnRzLmpzb24gZmlsZSBsb2NhdGlvbiBvbiB5b3VyIHNlcnZlci5cclxuICAgICAqL1xuICAgIGdldDogZnVuY3Rpb24gZ2V0KCkge1xuICAgICAgdmFyIHBvcnQgPSA4MDgwOyAvLyBDaGFuZ2UgdGhpcyB0byB5b3VyIHNlcnZlciBwb3J0XG5cbiAgICAgIHZhciB1cmwgPSAnaHR0cDovL2xvY2FsaG9zdDoxMzM3L3Jlc3RhdXJhbnRzJztcbiAgICAgIHJldHVybiB1cmw7XG4gICAgfVxuICB9XSk7XG5cbiAgcmV0dXJuIERCSGVscGVyO1xufSgpOyIsIlwidXNlIHN0cmljdFwiO1xuXG52YXIgcmVzdGF1cmFudHMsIG5laWdoYm9yaG9vZHMsIGN1aXNpbmVzO1xudmFyIG1hcDtcbnZhciBtYXJrZXJzID0gW107XG4vKipcbiAqIEZldGNoIG5laWdoYm9yaG9vZHMgYW5kIGN1aXNpbmVzIGFzIHNvb24gYXMgdGhlIHBhZ2UgaXMgbG9hZGVkLlxuICovXG5cbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgZmV0Y2hOZWlnaGJvcmhvb2RzKCk7XG4gIGZldGNoQ3Vpc2luZXMoKTtcbn0pO1xuLyoqXG4gKiBGZXRjaCBhbGwgbmVpZ2hib3Job29kcyBhbmQgc2V0IHRoZWlyIEhUTUwuXG4gKi9cblxudmFyIGZldGNoTmVpZ2hib3Job29kcyA9IGZ1bmN0aW9uIGZldGNoTmVpZ2hib3Job29kcygpIHtcbiAgREJIZWxwZXIuZmV0Y2hOZWlnaGJvcmhvb2RzKGZ1bmN0aW9uIChlcnJvciwgbmVpZ2hib3Job29kcykge1xuICAgIGlmIChlcnJvcikge1xuICAgICAgLy8gR290IGFuIGVycm9yXG4gICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc2VsZi5uZWlnaGJvcmhvb2RzID0gbmVpZ2hib3Job29kcztcbiAgICAgIGZpbGxOZWlnaGJvcmhvb2RzSFRNTCgpO1xuICAgIH1cbiAgfSk7XG59O1xuLyoqXG4gKiBTZXQgbmVpZ2hib3Job29kcyBIVE1MLlxuICovXG5cblxudmFyIGZpbGxOZWlnaGJvcmhvb2RzSFRNTCA9IGZ1bmN0aW9uIGZpbGxOZWlnaGJvcmhvb2RzSFRNTCgpIHtcbiAgdmFyIG5laWdoYm9yaG9vZHMgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IHNlbGYubmVpZ2hib3Job29kcztcbiAgdmFyIHNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduZWlnaGJvcmhvb2RzLXNlbGVjdCcpO1xuICBuZWlnaGJvcmhvb2RzLmZvckVhY2goZnVuY3Rpb24gKG5laWdoYm9yaG9vZCkge1xuICAgIHZhciBvcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvcHRpb24nKTtcbiAgICBvcHRpb24uaW5uZXJIVE1MID0gbmVpZ2hib3Job29kO1xuICAgIG9wdGlvbi52YWx1ZSA9IG5laWdoYm9yaG9vZDtcbiAgICBvcHRpb24uY2xhc3NOYW1lICs9IFwicmFkaW9cIjtcbiAgICBzZWxlY3QuYXBwZW5kKG9wdGlvbik7XG4gIH0pO1xufTtcbi8qKlxuICogRmV0Y2ggYWxsIGN1aXNpbmVzIGFuZCBzZXQgdGhlaXIgSFRNTC5cbiAqL1xuXG5cbnZhciBmZXRjaEN1aXNpbmVzID0gZnVuY3Rpb24gZmV0Y2hDdWlzaW5lcygpIHtcbiAgREJIZWxwZXIuZmV0Y2hDdWlzaW5lcyhmdW5jdGlvbiAoZXJyb3IsIGN1aXNpbmVzKSB7XG4gICAgaWYgKGVycm9yKSB7XG4gICAgICAvLyBHb3QgYW4gZXJyb3IhXG4gICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc2VsZi5jdWlzaW5lcyA9IGN1aXNpbmVzO1xuICAgICAgZmlsbEN1aXNpbmVzSFRNTCgpO1xuICAgIH1cbiAgfSk7XG59O1xuLyoqXG4gKiBTZXQgY3Vpc2luZXMgSFRNTC5cbiAqL1xuXG5cbnZhciBmaWxsQ3Vpc2luZXNIVE1MID0gZnVuY3Rpb24gZmlsbEN1aXNpbmVzSFRNTCgpIHtcbiAgdmFyIGN1aXNpbmVzID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiBzZWxmLmN1aXNpbmVzO1xuICB2YXIgc2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2N1aXNpbmVzLXNlbGVjdCcpO1xuICBjdWlzaW5lcy5mb3JFYWNoKGZ1bmN0aW9uIChjdWlzaW5lKSB7XG4gICAgdmFyIG9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicpO1xuICAgIG9wdGlvbi5pbm5lckhUTUwgPSBjdWlzaW5lO1xuICAgIG9wdGlvbi52YWx1ZSA9IGN1aXNpbmU7XG4gICAgc2VsZWN0LmFwcGVuZChvcHRpb24pO1xuICB9KTtcbn07XG4vKipcbiAqIEluaXRpYWxpemUgR29vZ2xlIG1hcCwgY2FsbGVkIGZyb20gSFRNTC5cbiAqL1xuXG5cbndpbmRvdy5pbml0TWFwID0gZnVuY3Rpb24gKCkge1xuICB2YXIgbG9jID0ge1xuICAgIGxhdDogNDAuNzIyMjE2LFxuICAgIGxuZzogLTczLjk4NzUwMVxuICB9O1xuICBzZWxmLm1hcCA9IG5ldyBnb29nbGUubWFwcy5NYXAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hcCcpLCB7XG4gICAgem9vbTogMTIsXG4gICAgY2VudGVyOiBsb2MsXG4gICAgc2Nyb2xsd2hlZWw6IGZhbHNlXG4gIH0pO1xuICB1cGRhdGVSZXN0YXVyYW50cygpO1xufTtcbi8qKlxuICogVXBkYXRlIHBhZ2UgYW5kIG1hcCBmb3IgY3VycmVudCByZXN0YXVyYW50cy5cbiAqL1xuXG5cbnZhciB1cGRhdGVSZXN0YXVyYW50cyA9IGZ1bmN0aW9uIHVwZGF0ZVJlc3RhdXJhbnRzKCkge1xuICB2YXIgY1NlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjdWlzaW5lcy1zZWxlY3QnKTtcbiAgdmFyIG5TZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbmVpZ2hib3Job29kcy1zZWxlY3QnKTtcbiAgdmFyIGNJbmRleCA9IGNTZWxlY3Quc2VsZWN0ZWRJbmRleDtcbiAgdmFyIG5JbmRleCA9IG5TZWxlY3Quc2VsZWN0ZWRJbmRleDtcbiAgdmFyIGN1aXNpbmUgPSBjU2VsZWN0W2NJbmRleF0udmFsdWU7XG4gIHZhciBuZWlnaGJvcmhvb2QgPSBuU2VsZWN0W25JbmRleF0udmFsdWU7XG4gIERCSGVscGVyLmZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZUFuZE5laWdoYm9yaG9vZChjdWlzaW5lLCBuZWlnaGJvcmhvb2QsIGZ1bmN0aW9uIChlcnJvciwgcmVzdGF1cmFudHMpIHtcbiAgICBpZiAoZXJyb3IpIHtcbiAgICAgIC8vIEdvdCBhbiBlcnJvciFcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXNldFJlc3RhdXJhbnRzKHJlc3RhdXJhbnRzKTtcbiAgICAgIGZpbGxSZXN0YXVyYW50c0hUTUwoKTtcbiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNyZXN0YXVyYW50cy1saXN0Jykuc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgXCJMaXN0IG9mIFJlc3RhdXJhbnRzIFwiLmNvbmNhdChuZWlnaGJvcmhvb2QgPyBuZWlnaGJvcmhvb2QgPT0gJ2FsbCcgPyAnJyA6IFwiRmlsdGVyZWQgYnkgXCIuY29uY2F0KG5laWdoYm9yaG9vZCkgOiAnJywgXCIgXCIpLmNvbmNhdChjdWlzaW5lID8gY3Vpc2luZSA9PSAnYWxsJyA/ICcnIDogXCJhbmQgXCIuY29uY2F0KGN1aXNpbmUpIDogJycpKTtcbiAgICB9XG4gIH0pO1xufTtcbi8qKlxuICogQ2xlYXIgY3VycmVudCByZXN0YXVyYW50cywgdGhlaXIgSFRNTCBhbmQgcmVtb3ZlIHRoZWlyIG1hcCBtYXJrZXJzLlxuICovXG5cblxudmFyIHJlc2V0UmVzdGF1cmFudHMgPSBmdW5jdGlvbiByZXNldFJlc3RhdXJhbnRzKHJlc3RhdXJhbnRzKSB7XG4gIC8vIFJlbW92ZSBhbGwgcmVzdGF1cmFudHNcbiAgc2VsZi5yZXN0YXVyYW50cyA9IFtdO1xuICB2YXIgdWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudHMtbGlzdCcpO1xuICB1bC5pbm5lckhUTUwgPSAnJzsgLy8gUmVtb3ZlIGFsbCBtYXAgbWFya2Vyc1xuXG4gIHNlbGYubWFya2Vycy5mb3JFYWNoKGZ1bmN0aW9uIChtKSB7XG4gICAgcmV0dXJuIG0uc2V0TWFwKG51bGwpO1xuICB9KTtcbiAgc2VsZi5tYXJrZXJzID0gW107XG4gIHNlbGYucmVzdGF1cmFudHMgPSByZXN0YXVyYW50cztcbn07XG4vKipcbiAqIENyZWF0ZSBhbGwgcmVzdGF1cmFudHMgSFRNTCBhbmQgYWRkIHRoZW0gdG8gdGhlIHdlYnBhZ2UuXG4gKi9cblxuXG52YXIgZmlsbFJlc3RhdXJhbnRzSFRNTCA9IGZ1bmN0aW9uIGZpbGxSZXN0YXVyYW50c0hUTUwoKSB7XG4gIHZhciByZXN0YXVyYW50cyA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogc2VsZi5yZXN0YXVyYW50cztcbiAgdmFyIHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnRzLWxpc3QnKTtcbiAgcmVzdGF1cmFudHMuZm9yRWFjaChmdW5jdGlvbiAocmVzdGF1cmFudCkge1xuICAgIHVsLmFwcGVuZChjcmVhdGVSZXN0YXVyYW50SFRNTChyZXN0YXVyYW50KSk7XG4gIH0pO1xuICBhZGRNYXJrZXJzVG9NYXAoKTsgLy8gTGF6eSBMb2FkIEltYWdlc1xuXG4gIGxhenlMb2FkZXIoKTtcbn07XG4vKipcbiAqIENyZWF0ZSByZXN0YXVyYW50IEhUTUwuXG4gKi9cblxuXG52YXIgY3JlYXRlUmVzdGF1cmFudEhUTUwgPSBmdW5jdGlvbiBjcmVhdGVSZXN0YXVyYW50SFRNTChyZXN0YXVyYW50KSB7XG4gIHZhciBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XG4gIHZhciBpbWFnZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpO1xuICBpbWFnZS5jbGFzc05hbWUgPSAncmVzdGF1cmFudC1pbWcgbGF6eSc7XG4gIGltYWdlLnNldEF0dHJpYnV0ZSgnZGF0YS1zcmMnLCBEQkhlbHBlci5pbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCkpO1xuICBpbWFnZS5zZXRBdHRyaWJ1dGUoJ3NyYycsICcgJyk7XG4gIGltYWdlLmFsdCA9IHJlc3RhdXJhbnQubmFtZSArICdyZXN0YXVyYW50JztcbiAgbGkuYXBwZW5kKGltYWdlKTtcbiAgdmFyIG5hbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdoMicpO1xuICBuYW1lLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmFtZTtcbiAgbmFtZS5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCBcInJlc3RhdXJhbnQgbmFtZTogXCIuY29uY2F0KHJlc3RhdXJhbnQubmFtZSkpO1xuICBsaS5hcHBlbmQobmFtZSk7XG4gIHZhciBuZWlnaGJvcmhvb2QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gIG5laWdoYm9yaG9vZC5pbm5lckhUTUwgPSByZXN0YXVyYW50Lm5laWdoYm9yaG9vZDtcbiAgbmVpZ2hib3Job29kLnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsIFwibmVpZ2hib3Job29kOiBcIi5jb25jYXQocmVzdGF1cmFudC5uZWlnaGJvcmhvb2QpKTtcbiAgbGkuYXBwZW5kKG5laWdoYm9yaG9vZCk7XG4gIHZhciBhZGRyZXNzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICBhZGRyZXNzLmlubmVySFRNTCA9IHJlc3RhdXJhbnQuYWRkcmVzcztcbiAgYWRkcmVzcy5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCBcInJlc3RhdXJhbnQgYWRkcmVzczogXCIuY29uY2F0KHJlc3RhdXJhbnQuYWRkcmVzcykpO1xuICBsaS5hcHBlbmQoYWRkcmVzcyk7XG4gIHZhciBtb3JlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpO1xuICBtb3JlLmlubmVySFRNTCA9ICdWaWV3IERldGFpbHMnO1xuICBtb3JlLmhyZWYgPSBEQkhlbHBlci51cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpO1xuICBtb3JlLnNldEF0dHJpYnV0ZSgncm9sZScsICdidXR0b24nKTtcbiAgbW9yZS5zZXRBdHRyaWJ1dGUoJ3RhYmluZGV4JywgJzAnKTtcbiAgbW9yZS5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCBcIkNsaWNrIHRvIG5hdmlnYXRlIHRvIFwiLmNvbmNhdChyZXN0YXVyYW50Lm5hbWUsIFwiIHJldmlldyBwYWdlLiByZXN0YXVyYW50IGFkZHJlc3M6IFwiKS5jb25jYXQocmVzdGF1cmFudC5hZGRyZXNzLCBcIiBcIikuY29uY2F0KHJlc3RhdXJhbnQubmVpZ2hib3Job29kLCBcIi4gXCIpKTtcbiAgbGkuYXBwZW5kKG1vcmUpO1xuICByZXR1cm4gbGk7XG59O1xuLyoqXG4gKiBBZGQgbWFya2VycyBmb3IgY3VycmVudCByZXN0YXVyYW50cyB0byB0aGUgbWFwLlxuICovXG5cblxudmFyIGFkZE1hcmtlcnNUb01hcCA9IGZ1bmN0aW9uIGFkZE1hcmtlcnNUb01hcCgpIHtcbiAgdmFyIHJlc3RhdXJhbnRzID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiBzZWxmLnJlc3RhdXJhbnRzO1xuICByZXN0YXVyYW50cy5mb3JFYWNoKGZ1bmN0aW9uIChyZXN0YXVyYW50KSB7XG4gICAgLy8gQWRkIG1hcmtlciB0byB0aGUgbWFwXG4gICAgdmFyIG1hcmtlciA9IERCSGVscGVyLm1hcE1hcmtlckZvclJlc3RhdXJhbnQocmVzdGF1cmFudCwgc2VsZi5tYXApO1xuICAgIGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKG1hcmtlciwgJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBtYXJrZXIudXJsO1xuICAgIH0pO1xuICAgIHNlbGYubWFya2Vycy5wdXNoKG1hcmtlcik7XG4gIH0pO1xufTsiLCJcInVzZSBzdHJpY3RcIjtcblxuZnVuY3Rpb24gbGF6eUxvYWRlcigpIHtcbiAgY29uc29sZS5sb2coJ2V4ZWN1dGluZyBsYXp5IGxvYWRpbmcnKTtcbiAgdmFyIGxhenlJbWFnZXMgPSBbXS5zbGljZS5jYWxsKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCJpbWcubGF6eVwiKSk7XG4gIHZhciBhY3RpdmUgPSBmYWxzZTtcblxuICB2YXIgbGF6eUxvYWQgPSBmdW5jdGlvbiBsYXp5TG9hZCgpIHtcbiAgICBpZiAoYWN0aXZlID09PSBmYWxzZSkge1xuICAgICAgYWN0aXZlID0gdHJ1ZTtcbiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICBsYXp5SW1hZ2VzLmZvckVhY2goZnVuY3Rpb24gKGxhenlJbWFnZSkge1xuICAgICAgICAgIGlmIChsYXp5SW1hZ2UuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkudG9wIDw9IHdpbmRvdy5pbm5lckhlaWdodCAmJiBsYXp5SW1hZ2UuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkuYm90dG9tID49IDAgJiYgZ2V0Q29tcHV0ZWRTdHlsZShsYXp5SW1hZ2UpLmRpc3BsYXkgIT09IFwibm9uZVwiKSB7XG4gICAgICAgICAgICBsYXp5SW1hZ2Uuc3JjID0gbGF6eUltYWdlLmdldEF0dHJpYnV0ZSgnZGF0YS1zcmMnKTsgLy8gbGF6eUltYWdlLnNyY3NldCA9IGxhenlJbWFnZS5kYXRhc2V0LnNyY3NldDtcblxuICAgICAgICAgICAgbGF6eUltYWdlLmNsYXNzTGlzdC5yZW1vdmUoXCJsYXp5XCIpO1xuICAgICAgICAgICAgbGF6eUltYWdlcyA9IGxhenlJbWFnZXMuZmlsdGVyKGZ1bmN0aW9uIChpbWFnZSkge1xuICAgICAgICAgICAgICByZXR1cm4gaW1hZ2UgIT09IGxhenlJbWFnZTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpZiAobGF6eUltYWdlcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInNjcm9sbFwiLCBsYXp5TG9hZCk7XG4gICAgICAgICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKFwicmVzaXplXCIsIGxhenlMb2FkKTtcbiAgICAgICAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJvcmllbnRhdGlvbmNoYW5nZVwiLCBsYXp5TG9hZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgYWN0aXZlID0gZmFsc2U7XG4gICAgICB9LCAyMDApO1xuICAgIH1cbiAgfTtcblxuICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwic2Nyb2xsXCIsIGxhenlMb2FkKTtcbiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJyZXNpemVcIiwgbGF6eUxvYWQpO1xuICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcIm9yaWVudGF0aW9uY2hhbmdlXCIsIGxhenlMb2FkKTtcbn0iLCIndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIHRvQXJyYXkoYXJyKSB7XG4gICAgcmV0dXJuIEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFycik7XG4gIH1cblxuICBmdW5jdGlvbiBwcm9taXNpZnlSZXF1ZXN0KHJlcXVlc3QpIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJlc29sdmUocmVxdWVzdC5yZXN1bHQpO1xuICAgICAgfTtcblxuICAgICAgcmVxdWVzdC5vbmVycm9yID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZWplY3QocmVxdWVzdC5lcnJvcik7XG4gICAgICB9O1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJvbWlzaWZ5UmVxdWVzdENhbGwob2JqLCBtZXRob2QsIGFyZ3MpIHtcbiAgICB2YXIgcmVxdWVzdDtcbiAgICB2YXIgcCA9IG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgIHJlcXVlc3QgPSBvYmpbbWV0aG9kXS5hcHBseShvYmosIGFyZ3MpO1xuICAgICAgcHJvbWlzaWZ5UmVxdWVzdChyZXF1ZXN0KS50aGVuKHJlc29sdmUsIHJlamVjdCk7XG4gICAgfSk7XG4gICAgcC5yZXF1ZXN0ID0gcmVxdWVzdDtcbiAgICByZXR1cm4gcDtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb21pc2lmeUN1cnNvclJlcXVlc3RDYWxsKG9iaiwgbWV0aG9kLCBhcmdzKSB7XG4gICAgdmFyIHAgPSBwcm9taXNpZnlSZXF1ZXN0Q2FsbChvYmosIG1ldGhvZCwgYXJncyk7XG4gICAgcmV0dXJuIHAudGhlbihmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgIGlmICghdmFsdWUpIHJldHVybjtcbiAgICAgIHJldHVybiBuZXcgQ3Vyc29yKHZhbHVlLCBwLnJlcXVlc3QpO1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJveHlQcm9wZXJ0aWVzKFByb3h5Q2xhc3MsIHRhcmdldFByb3AsIHByb3BlcnRpZXMpIHtcbiAgICBwcm9wZXJ0aWVzLmZvckVhY2goZnVuY3Rpb24gKHByb3ApIHtcbiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShQcm94eUNsYXNzLnByb3RvdHlwZSwgcHJvcCwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHtcbiAgICAgICAgICByZXR1cm4gdGhpc1t0YXJnZXRQcm9wXVtwcm9wXTtcbiAgICAgICAgfSxcbiAgICAgICAgc2V0OiBmdW5jdGlvbiBzZXQodmFsKSB7XG4gICAgICAgICAgdGhpc1t0YXJnZXRQcm9wXVtwcm9wXSA9IHZhbDtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBwcm94eVJlcXVlc3RNZXRob2RzKFByb3h5Q2xhc3MsIHRhcmdldFByb3AsIENvbnN0cnVjdG9yLCBwcm9wZXJ0aWVzKSB7XG4gICAgcHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uIChwcm9wKSB7XG4gICAgICBpZiAoIShwcm9wIGluIENvbnN0cnVjdG9yLnByb3RvdHlwZSkpIHJldHVybjtcblxuICAgICAgUHJveHlDbGFzcy5wcm90b3R5cGVbcHJvcF0gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBwcm9taXNpZnlSZXF1ZXN0Q2FsbCh0aGlzW3RhcmdldFByb3BdLCBwcm9wLCBhcmd1bWVudHMpO1xuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb3h5TWV0aG9kcyhQcm94eUNsYXNzLCB0YXJnZXRQcm9wLCBDb25zdHJ1Y3RvciwgcHJvcGVydGllcykge1xuICAgIHByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbiAocHJvcCkge1xuICAgICAgaWYgKCEocHJvcCBpbiBDb25zdHJ1Y3Rvci5wcm90b3R5cGUpKSByZXR1cm47XG5cbiAgICAgIFByb3h5Q2xhc3MucHJvdG90eXBlW3Byb3BdID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpc1t0YXJnZXRQcm9wXVtwcm9wXS5hcHBseSh0aGlzW3RhcmdldFByb3BdLCBhcmd1bWVudHMpO1xuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb3h5Q3Vyc29yUmVxdWVzdE1ldGhvZHMoUHJveHlDbGFzcywgdGFyZ2V0UHJvcCwgQ29uc3RydWN0b3IsIHByb3BlcnRpZXMpIHtcbiAgICBwcm9wZXJ0aWVzLmZvckVhY2goZnVuY3Rpb24gKHByb3ApIHtcbiAgICAgIGlmICghKHByb3AgaW4gQ29uc3RydWN0b3IucHJvdG90eXBlKSkgcmV0dXJuO1xuXG4gICAgICBQcm94eUNsYXNzLnByb3RvdHlwZVtwcm9wXSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHByb21pc2lmeUN1cnNvclJlcXVlc3RDYWxsKHRoaXNbdGFyZ2V0UHJvcF0sIHByb3AsIGFyZ3VtZW50cyk7XG4gICAgICB9O1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gSW5kZXgoaW5kZXgpIHtcbiAgICB0aGlzLl9pbmRleCA9IGluZGV4O1xuICB9XG5cbiAgcHJveHlQcm9wZXJ0aWVzKEluZGV4LCAnX2luZGV4JywgWyduYW1lJywgJ2tleVBhdGgnLCAnbXVsdGlFbnRyeScsICd1bmlxdWUnXSk7XG4gIHByb3h5UmVxdWVzdE1ldGhvZHMoSW5kZXgsICdfaW5kZXgnLCBJREJJbmRleCwgWydnZXQnLCAnZ2V0S2V5JywgJ2dldEFsbCcsICdnZXRBbGxLZXlzJywgJ2NvdW50J10pO1xuICBwcm94eUN1cnNvclJlcXVlc3RNZXRob2RzKEluZGV4LCAnX2luZGV4JywgSURCSW5kZXgsIFsnb3BlbkN1cnNvcicsICdvcGVuS2V5Q3Vyc29yJ10pO1xuXG4gIGZ1bmN0aW9uIEN1cnNvcihjdXJzb3IsIHJlcXVlc3QpIHtcbiAgICB0aGlzLl9jdXJzb3IgPSBjdXJzb3I7XG4gICAgdGhpcy5fcmVxdWVzdCA9IHJlcXVlc3Q7XG4gIH1cblxuICBwcm94eVByb3BlcnRpZXMoQ3Vyc29yLCAnX2N1cnNvcicsIFsnZGlyZWN0aW9uJywgJ2tleScsICdwcmltYXJ5S2V5JywgJ3ZhbHVlJ10pO1xuICBwcm94eVJlcXVlc3RNZXRob2RzKEN1cnNvciwgJ19jdXJzb3InLCBJREJDdXJzb3IsIFsndXBkYXRlJywgJ2RlbGV0ZSddKTsgLy8gcHJveHkgJ25leHQnIG1ldGhvZHNcblxuICBbJ2FkdmFuY2UnLCAnY29udGludWUnLCAnY29udGludWVQcmltYXJ5S2V5J10uZm9yRWFjaChmdW5jdGlvbiAobWV0aG9kTmFtZSkge1xuICAgIGlmICghKG1ldGhvZE5hbWUgaW4gSURCQ3Vyc29yLnByb3RvdHlwZSkpIHJldHVybjtcblxuICAgIEN1cnNvci5wcm90b3R5cGVbbWV0aG9kTmFtZV0gPSBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgY3Vyc29yID0gdGhpcztcbiAgICAgIHZhciBhcmdzID0gYXJndW1lbnRzO1xuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICBjdXJzb3IuX2N1cnNvclttZXRob2ROYW1lXS5hcHBseShjdXJzb3IuX2N1cnNvciwgYXJncyk7XG5cbiAgICAgICAgcmV0dXJuIHByb21pc2lmeVJlcXVlc3QoY3Vyc29yLl9yZXF1ZXN0KS50aGVuKGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgIGlmICghdmFsdWUpIHJldHVybjtcbiAgICAgICAgICByZXR1cm4gbmV3IEN1cnNvcih2YWx1ZSwgY3Vyc29yLl9yZXF1ZXN0KTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9O1xuICB9KTtcblxuICBmdW5jdGlvbiBPYmplY3RTdG9yZShzdG9yZSkge1xuICAgIHRoaXMuX3N0b3JlID0gc3RvcmU7XG4gIH1cblxuICBPYmplY3RTdG9yZS5wcm90b3R5cGUuY3JlYXRlSW5kZXggPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIG5ldyBJbmRleCh0aGlzLl9zdG9yZS5jcmVhdGVJbmRleC5hcHBseSh0aGlzLl9zdG9yZSwgYXJndW1lbnRzKSk7XG4gIH07XG5cbiAgT2JqZWN0U3RvcmUucHJvdG90eXBlLmluZGV4ID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBuZXcgSW5kZXgodGhpcy5fc3RvcmUuaW5kZXguYXBwbHkodGhpcy5fc3RvcmUsIGFyZ3VtZW50cykpO1xuICB9O1xuXG4gIHByb3h5UHJvcGVydGllcyhPYmplY3RTdG9yZSwgJ19zdG9yZScsIFsnbmFtZScsICdrZXlQYXRoJywgJ2luZGV4TmFtZXMnLCAnYXV0b0luY3JlbWVudCddKTtcbiAgcHJveHlSZXF1ZXN0TWV0aG9kcyhPYmplY3RTdG9yZSwgJ19zdG9yZScsIElEQk9iamVjdFN0b3JlLCBbJ3B1dCcsICdhZGQnLCAnZGVsZXRlJywgJ2NsZWFyJywgJ2dldCcsICdnZXRBbGwnLCAnZ2V0S2V5JywgJ2dldEFsbEtleXMnLCAnY291bnQnXSk7XG4gIHByb3h5Q3Vyc29yUmVxdWVzdE1ldGhvZHMoT2JqZWN0U3RvcmUsICdfc3RvcmUnLCBJREJPYmplY3RTdG9yZSwgWydvcGVuQ3Vyc29yJywgJ29wZW5LZXlDdXJzb3InXSk7XG4gIHByb3h5TWV0aG9kcyhPYmplY3RTdG9yZSwgJ19zdG9yZScsIElEQk9iamVjdFN0b3JlLCBbJ2RlbGV0ZUluZGV4J10pO1xuXG4gIGZ1bmN0aW9uIFRyYW5zYWN0aW9uKGlkYlRyYW5zYWN0aW9uKSB7XG4gICAgdGhpcy5fdHggPSBpZGJUcmFuc2FjdGlvbjtcbiAgICB0aGlzLmNvbXBsZXRlID0gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgaWRiVHJhbnNhY3Rpb24ub25jb21wbGV0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgfTtcblxuICAgICAgaWRiVHJhbnNhY3Rpb24ub25lcnJvciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmVqZWN0KGlkYlRyYW5zYWN0aW9uLmVycm9yKTtcbiAgICAgIH07XG5cbiAgICAgIGlkYlRyYW5zYWN0aW9uLm9uYWJvcnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJlamVjdChpZGJUcmFuc2FjdGlvbi5lcnJvcik7XG4gICAgICB9O1xuICAgIH0pO1xuICB9XG5cbiAgVHJhbnNhY3Rpb24ucHJvdG90eXBlLm9iamVjdFN0b3JlID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBuZXcgT2JqZWN0U3RvcmUodGhpcy5fdHgub2JqZWN0U3RvcmUuYXBwbHkodGhpcy5fdHgsIGFyZ3VtZW50cykpO1xuICB9O1xuXG4gIHByb3h5UHJvcGVydGllcyhUcmFuc2FjdGlvbiwgJ190eCcsIFsnb2JqZWN0U3RvcmVOYW1lcycsICdtb2RlJ10pO1xuICBwcm94eU1ldGhvZHMoVHJhbnNhY3Rpb24sICdfdHgnLCBJREJUcmFuc2FjdGlvbiwgWydhYm9ydCddKTtcblxuICBmdW5jdGlvbiBVcGdyYWRlREIoZGIsIG9sZFZlcnNpb24sIHRyYW5zYWN0aW9uKSB7XG4gICAgdGhpcy5fZGIgPSBkYjtcbiAgICB0aGlzLm9sZFZlcnNpb24gPSBvbGRWZXJzaW9uO1xuICAgIHRoaXMudHJhbnNhY3Rpb24gPSBuZXcgVHJhbnNhY3Rpb24odHJhbnNhY3Rpb24pO1xuICB9XG5cbiAgVXBncmFkZURCLnByb3RvdHlwZS5jcmVhdGVPYmplY3RTdG9yZSA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gbmV3IE9iamVjdFN0b3JlKHRoaXMuX2RiLmNyZWF0ZU9iamVjdFN0b3JlLmFwcGx5KHRoaXMuX2RiLCBhcmd1bWVudHMpKTtcbiAgfTtcblxuICBwcm94eVByb3BlcnRpZXMoVXBncmFkZURCLCAnX2RiJywgWyduYW1lJywgJ3ZlcnNpb24nLCAnb2JqZWN0U3RvcmVOYW1lcyddKTtcbiAgcHJveHlNZXRob2RzKFVwZ3JhZGVEQiwgJ19kYicsIElEQkRhdGFiYXNlLCBbJ2RlbGV0ZU9iamVjdFN0b3JlJywgJ2Nsb3NlJ10pO1xuXG4gIGZ1bmN0aW9uIERCKGRiKSB7XG4gICAgdGhpcy5fZGIgPSBkYjtcbiAgfVxuXG4gIERCLnByb3RvdHlwZS50cmFuc2FjdGlvbiA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gbmV3IFRyYW5zYWN0aW9uKHRoaXMuX2RiLnRyYW5zYWN0aW9uLmFwcGx5KHRoaXMuX2RiLCBhcmd1bWVudHMpKTtcbiAgfTtcblxuICBwcm94eVByb3BlcnRpZXMoREIsICdfZGInLCBbJ25hbWUnLCAndmVyc2lvbicsICdvYmplY3RTdG9yZU5hbWVzJ10pO1xuICBwcm94eU1ldGhvZHMoREIsICdfZGInLCBJREJEYXRhYmFzZSwgWydjbG9zZSddKTsgLy8gQWRkIGN1cnNvciBpdGVyYXRvcnNcbiAgLy8gVE9ETzogcmVtb3ZlIHRoaXMgb25jZSBicm93c2VycyBkbyB0aGUgcmlnaHQgdGhpbmcgd2l0aCBwcm9taXNlc1xuXG4gIFsnb3BlbkN1cnNvcicsICdvcGVuS2V5Q3Vyc29yJ10uZm9yRWFjaChmdW5jdGlvbiAoZnVuY05hbWUpIHtcbiAgICBbT2JqZWN0U3RvcmUsIEluZGV4XS5mb3JFYWNoKGZ1bmN0aW9uIChDb25zdHJ1Y3Rvcikge1xuICAgICAgLy8gRG9uJ3QgY3JlYXRlIGl0ZXJhdGVLZXlDdXJzb3IgaWYgb3BlbktleUN1cnNvciBkb2Vzbid0IGV4aXN0LlxuICAgICAgaWYgKCEoZnVuY05hbWUgaW4gQ29uc3RydWN0b3IucHJvdG90eXBlKSkgcmV0dXJuO1xuXG4gICAgICBDb25zdHJ1Y3Rvci5wcm90b3R5cGVbZnVuY05hbWUucmVwbGFjZSgnb3BlbicsICdpdGVyYXRlJyldID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgYXJncyA9IHRvQXJyYXkoYXJndW1lbnRzKTtcbiAgICAgICAgdmFyIGNhbGxiYWNrID0gYXJnc1thcmdzLmxlbmd0aCAtIDFdO1xuICAgICAgICB2YXIgbmF0aXZlT2JqZWN0ID0gdGhpcy5fc3RvcmUgfHwgdGhpcy5faW5kZXg7XG4gICAgICAgIHZhciByZXF1ZXN0ID0gbmF0aXZlT2JqZWN0W2Z1bmNOYW1lXS5hcHBseShuYXRpdmVPYmplY3QsIGFyZ3Muc2xpY2UoMCwgLTEpKTtcblxuICAgICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBjYWxsYmFjayhyZXF1ZXN0LnJlc3VsdCk7XG4gICAgICAgIH07XG4gICAgICB9O1xuICAgIH0pO1xuICB9KTsgLy8gcG9seWZpbGwgZ2V0QWxsXG5cbiAgW0luZGV4LCBPYmplY3RTdG9yZV0uZm9yRWFjaChmdW5jdGlvbiAoQ29uc3RydWN0b3IpIHtcbiAgICBpZiAoQ29uc3RydWN0b3IucHJvdG90eXBlLmdldEFsbCkgcmV0dXJuO1xuXG4gICAgQ29uc3RydWN0b3IucHJvdG90eXBlLmdldEFsbCA9IGZ1bmN0aW9uIChxdWVyeSwgY291bnQpIHtcbiAgICAgIHZhciBpbnN0YW5jZSA9IHRoaXM7XG4gICAgICB2YXIgaXRlbXMgPSBbXTtcbiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSkge1xuICAgICAgICBpbnN0YW5jZS5pdGVyYXRlQ3Vyc29yKHF1ZXJ5LCBmdW5jdGlvbiAoY3Vyc29yKSB7XG4gICAgICAgICAgaWYgKCFjdXJzb3IpIHtcbiAgICAgICAgICAgIHJlc29sdmUoaXRlbXMpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGl0ZW1zLnB1c2goY3Vyc29yLnZhbHVlKTtcblxuICAgICAgICAgIGlmIChjb3VudCAhPT0gdW5kZWZpbmVkICYmIGl0ZW1zLmxlbmd0aCA9PSBjb3VudCkge1xuICAgICAgICAgICAgcmVzb2x2ZShpdGVtcyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgY3Vyc29yLmNvbnRpbnVlKCk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfTtcbiAgfSk7XG4gIHZhciBleHAgPSB7XG4gICAgb3BlbjogZnVuY3Rpb24gb3BlbihuYW1lLCB2ZXJzaW9uLCB1cGdyYWRlQ2FsbGJhY2spIHtcbiAgICAgIHZhciBwID0gcHJvbWlzaWZ5UmVxdWVzdENhbGwoaW5kZXhlZERCLCAnb3BlbicsIFtuYW1lLCB2ZXJzaW9uXSk7XG4gICAgICB2YXIgcmVxdWVzdCA9IHAucmVxdWVzdDtcblxuICAgICAgaWYgKHJlcXVlc3QpIHtcbiAgICAgICAgcmVxdWVzdC5vbnVwZ3JhZGVuZWVkZWQgPSBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICBpZiAodXBncmFkZUNhbGxiYWNrKSB7XG4gICAgICAgICAgICB1cGdyYWRlQ2FsbGJhY2sobmV3IFVwZ3JhZGVEQihyZXF1ZXN0LnJlc3VsdCwgZXZlbnQub2xkVmVyc2lvbiwgcmVxdWVzdC50cmFuc2FjdGlvbikpO1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHAudGhlbihmdW5jdGlvbiAoZGIpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEQihkYik7XG4gICAgICB9KTtcbiAgICB9LFxuICAgIGRlbGV0ZTogZnVuY3Rpb24gX2RlbGV0ZShuYW1lKSB7XG4gICAgICByZXR1cm4gcHJvbWlzaWZ5UmVxdWVzdENhbGwoaW5kZXhlZERCLCAnZGVsZXRlRGF0YWJhc2UnLCBbbmFtZV0pO1xuICAgIH1cbiAgfTtcblxuICBpZiAodHlwZW9mIG1vZHVsZSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICBtb2R1bGUuZXhwb3J0cyA9IGV4cDtcbiAgICBtb2R1bGUuZXhwb3J0cy5kZWZhdWx0ID0gbW9kdWxlLmV4cG9ydHM7XG4gIH0gZWxzZSB7XG4gICAgc2VsZi5pZGIgPSBleHA7XG4gIH1cbn0pKCk7IiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbi8qIFNlcnZpY2UgV29ya2VyICovXG5pZiAobmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIpIHtcbiAgbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIucmVnaXN0ZXIoJ3N3LmpzJykudGhlbihmdW5jdGlvbiAocmVnKSB7XG4gICAgY29uc29sZS5sb2coJ3NlcnZpY2Ugd29ya2VyIHJlZ2lzdGVyZWQuJyk7XG4gICAgY29uc29sZS5sb2cocmVnKTtcbiAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xuICAgIGNvbnNvbGUubG9nKCdwcm9ibGVtIHJlZ2lzdGVyaW5nIHNlcnZpY2Ugd29ya2VyJyk7XG4gICAgY29uc29sZS5sb2coZXJyKTtcbiAgfSk7XG59Il19
